<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
/* â–  Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
body {
  margin: 0;
  font-family: 'Cairo', sans-serif;
  background: #f5f7fa;
  
}

/* â–  Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
.sidebar {
  width: 260px;
  background: #065f6a;
  color: #fff;
  height: 100vh;
  padding: 20px 20px 0 20px;
  position: fixed;
  right: 0;
  top: 0;
  display: flex;
  flex-direction: column;
  gap: 20px;
  box-shadow: 0 0 12px rgba(0,0,0,0.15);
  z-index: 1000;
  overflow: hidden;
}

.sidebar h2 {
  flex-shrink: 0;
}

.sidebar h2 {
  margin: 0;
  font-size: 22px;
}

/* â–  Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
.nav-links {
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
  overflow-x: hidden;
  flex: 1;
  padding-right: 5px;
  margin-right: -5px;
  min-height: 0;
}

/* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
.nav-links::-webkit-scrollbar {
  width: 6px;
}

.nav-links::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}

.nav-links::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  transition: background 0.3s;
}

.nav-links::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.5);
}

/* Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ - Ø«Ø§Ø¨Øª ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
.logout-section {
  flex-shrink: 0;
  margin-top: auto;
  padding-top: 5px;
  padding-bottom: 30px;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
}

.nav-links a {
  color: #fff;
  padding: 12px;
  background: #0d7b86;
  border-radius: 8px;
  text-decoration: none;
  font-size: 16px;
  cursor: pointer;
  transition: 0.2s;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.notification-badge {
  background: #e91e63;
  color: white;
  border-radius: 12px;
  padding: 2px 8px;
  font-size: 12px;
  font-weight: 700;
  min-width: 20px;
  text-align: center;
  margin-right: 8px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.nav-links a:hover {
  background: #0a616b;
}

.nav-links a.active {
  background: #094f56 !important;
  border-right: 4px solid #fff;
}

/* â–  Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
.content {
  margin-right: 50px;
  padding: 0;
  min-height: 100vh;
  box-sizing: border-box;
}


iframe {
  width: calc(100% - 260px);
  margin-right: 260px;
  min-height: 100vh;
  border: none;
  display: block;
}

</style>

</head>
<body>

<!-- â–  Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± -->
<div class="sidebar">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

  <div class="nav-links">
    <a data-page="dashboard" onclick="loadPage('admin/dashboard.html', this)">ğŸ“Š Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a data-page="products" onclick="loadPage('admin/products.html', this)">ğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
    <a data-page="orders" onclick="loadPage('admin/orders.html', this)" id="ordersLink">
      ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      <span class="notification-badge" id="ordersBadge" style="display:none;">0</span>
    </a>
    <a data-page="brands" onclick="loadPage('admin/brands.html', this)">ğŸ·ï¸ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</a>
	<a data-page="invoice" onclick="loadPage('admin/users.html', this)" id="usersLink">
      ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
      <span class="notification-badge" id="usersBadge" style="display:none;">0</span>
    </a>
	<a data-page="banners" onclick="loadPage('admin/banners.html', this)">ğŸ¨ Ø¨Ø§Ù†Ø±Ø§Øª Ø§Ù„Ø¹Ø±ÙˆØ¶</a>
	<a data-page="privacy" onclick="loadPage('admin/privacy-policy.html', this)">ğŸ“‹ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©</a>
	<a data-page="return" onclick="loadPage('admin/return-policy.html', this)">ğŸ”„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙˆØ§Ù„Ø§Ø±Ø¬Ø§Ø¹</a>
	<a data-page="terms" onclick="loadPage('admin/terms.html', this)">ğŸ“œ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a>
	<a data-page="faq" onclick="loadPage('admin/faq.html', this)">â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</a>
	<a data-page="complaints" onclick="loadPage('admin/complaints.html', this)" id="complaintsLink">
      ğŸ“§ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
      <span class="notification-badge" id="complaintsBadge" style="display:none;">0</span>
    </a>
	<a data-page="support-chat" onclick="loadPage('admin/support-chat.html', this)" id="supportChatLink">
      ğŸ’¬ Ø´Ø§Øª Ø§Ù„Ø¯Ø¹Ù…
      <span class="notification-badge" id="supportChatBadge" style="display:none;">0</span>
    </a>
	<a data-page="reviews" onclick="loadPage('admin/reviews.html', this)" id="reviewsLink">
      â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
      <span class="notification-badge" id="reviewsBadge" style="display:none;">0</span>
    </a>
	<a data-page="coupons" onclick="loadPage('admin/coupons.html', this)">ğŸŸï¸ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø§Ù„Ø®ØµÙ…</a>
	<a data-page="social" onclick="loadPage('admin/social-media.html', this)">ğŸ“± Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§</a>
  </div>

  <div class="logout-section">
    <a onclick="logout()" style="color:#ffdada;display:block;padding:12px;background:#0d7b86;border-radius:8px;text-decoration:none;font-size:16px;cursor:pointer;transition:0.2s;text-align:center;">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
  </div>
</div>

<!-- â–  Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
<div class="content">
  <iframe id="frame" src="admin/dashboard.html"></iframe>
</div>

<script>
/* â–  Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
async function checkAuth() {
  try {
    const response = await fetch("/api/admin/check-auth", {
      credentials: "include"
    });
    const data = await response.json();
    
    if (!data.success || !data.authenticated) {
      window.location.href = "login.html";
      return false;
    }
    return true;
  } catch (error) {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©:", error);
    window.location.href = "login.html";
    return false;
  }
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
checkAuth();

/* â–  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ */
async function logout() {
  try {
    const response = await fetch("/api/admin/logout", {
      method: "POST",
      credentials: "include"
    });
    
    const data = await response.json();
    if (data.success) {
      window.location.href = "login.html";
    } else {
      // Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ APIØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
      window.location.href = "login.html";
    }
  } catch (error) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:", error);
    // Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ APIØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
    window.location.href = "login.html";
  }
}

/* â–  Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø§Øª */
function applyFixes() {
  const frame = document.getElementById("frame");
  const doc = frame.contentDocument || frame.contentWindow.document;

  if (!doc) return;

  const style = document.createElement("style");

  /* Ù†Ø¬Ø¹Ù„ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ø¨Ø¯ÙˆÙ† padding ÙˆØ¨Ø¯ÙˆÙ† margin Ù…Ø«Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
style.innerHTML = `
  /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
  body {
    margin: 0 !important;
    padding: 0px !important;   /* Ù…Ø³Ø§ÙØ© Ù…Ù† ÙÙˆÙ‚ ÙˆØªØ­Øª */
    background: #f5f7fa !important;
    box-sizing: border-box !important;
  }

  /* Ù…Ø³Ø§ÙØ© Ø£Ø³ÙÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¯Ø§Ø®Ù„ ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† */
  header, .page-header, .top-bar {
    margin-bottom: 20px !important;
  }

  /* Ù…Ù†Ø¹ ØªÙ…Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  .main, .container, .content-area {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
`;


  doc.head.appendChild(style);
}

/* â–  ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø§Øª + Active */
function loadPage(url, el) {
  document.getElementById("frame").src = url;

  document.querySelectorAll(".nav-links a").forEach(a => a.classList.remove("active"));
  if (el) el.classList.add("active");

  // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØµÙØ­Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ù†Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
  if (url.includes('users.html')) {
    localStorage.setItem('lastUsersPageVisit', new Date().toISOString());
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ±Ø§Ù‹
    const usersBadge = document.getElementById("usersBadge");
    if (usersBadge) {
      usersBadge.style.display = "none";
    }
  }

  setTimeout(applyFixes, 200);
}

/* â–  ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª */
async function updateNotificationCounts() {
  try {
    // Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const ordersRes = await fetch("/api/admin/new-orders-count", {
      credentials: "include"
    });
    if (ordersRes.ok) {
      const ordersData = await ordersRes.json();
      const ordersBadge = document.getElementById("ordersBadge");
      if (ordersBadge && ordersData.count > 0) {
        ordersBadge.textContent = ordersData.count;
        ordersBadge.style.display = "inline-block";
      } else if (ordersBadge) {
        ordersBadge.style.display = "none";
      }
    }

    // Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø© Ù…Ù† localStorage)
    const lastUsersVisit = localStorage.getItem('lastUsersPageVisit');
    const usersUrl = lastUsersVisit 
      ? `/api/admin/new-users-count?lastVisit=${encodeURIComponent(lastUsersVisit)}`
      : "/api/admin/new-users-count";
    
    const usersRes = await fetch(usersUrl, {
      credentials: "include"
    });
    if (usersRes.ok) {
      const usersData = await usersRes.json();
      const usersBadge = document.getElementById("usersBadge");
      if (usersBadge && usersData.count > 0) {
        usersBadge.textContent = usersData.count;
        usersBadge.style.display = "inline-block";
      } else if (usersBadge) {
        usersBadge.style.display = "none";
      }
    }

    // Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const reviewsRes = await fetch("/api/admin/new-reviews-count", {
      credentials: "include"
    });
    if (reviewsRes.ok) {
      const reviewsData = await reviewsRes.json();
      const reviewsBadge = document.getElementById("reviewsBadge");
      if (reviewsBadge && reviewsData.count > 0) {
        reviewsBadge.textContent = reviewsData.count;
        reviewsBadge.style.display = "inline-block";
      } else if (reviewsBadge) {
        reviewsBadge.style.display = "none";
      }
    }

    // Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const complaintsRes = await fetch("/api/admin/new-complaints-count", {
      credentials: "include"
    });
    if (complaintsRes.ok) {
      const complaintsData = await complaintsRes.json();
      const complaintsBadge = document.getElementById("complaintsBadge");
      if (complaintsBadge && complaintsData.count > 0) {
        complaintsBadge.textContent = complaintsData.count;
        complaintsBadge.style.display = "inline-block";
      } else if (complaintsBadge) {
        complaintsBadge.style.display = "none";
      }
    }

    // Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø§ØªØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const supportChatRes = await fetch("/api/admin/support/new-chats-count", {
      credentials: "include"
    });
    if (supportChatRes.ok) {
      const supportChatData = await supportChatRes.json();
      const supportChatBadge = document.getElementById("supportChatBadge");
      if (supportChatBadge && supportChatData.success && supportChatData.count > 0) {
        supportChatBadge.textContent = supportChatData.count;
        supportChatBadge.style.display = "inline-block";
      } else if (supportChatBadge) {
        supportChatBadge.style.display = "none";
      }
    }
  } catch (error) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª:", error);
  }
}

/* â–  Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© */
document.addEventListener("DOMContentLoaded", () => {
  document.querySelector('[data-page="dashboard"]').classList.add("active");
  setTimeout(applyFixes, 300);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
  updateNotificationCounts();
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
  setInterval(updateNotificationCounts, 10000);
});
</script>

</body>
</html>
