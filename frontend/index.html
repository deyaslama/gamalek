<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ØªØ¬Ø± Ø¬Ù…Ø§Ù„Ùƒ</title>

<!-- Ø³ÙŠØªÙ… Ø¯Ù…Ø¬ ÙƒÙ„ CSS Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ -->
<style>
.profile-container {
  padding: 20px;
  font-family: 'Cairo', sans-serif;
}
.invoice-container {
  max-width: 650px;
  margin: auto;
  background: white;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 0 25px rgba(0,0,0,0.1);
}

.invoice-title {
  text-align: center;
  color: #8a004a;
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 20px;
}

.invoice-info p {
  font-size: 18px;
  margin: 6px 0;
}

#invoiceItems .item-row {
  padding: 12px;
  background: #fafafa;
  border-radius: 10px;
  margin-bottom: 10px;
  border: 1px solid #ddd;
}

.print-btn {
  width: 100%;
  padding: 14px;
  background: #1976d2;
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  margin-top: 20px;
}

.back-btn {
  width: 100%;
  padding: 14px;
  background: #E91E63;
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  margin-top: 10px;
}

.profile-card {
  display: flex;
  background: linear-gradient(135deg, #ff8ac0, #7a004b);
  color: white;
  padding: 20px;
  border-radius: 14px;
  margin-bottom: 20px;
  align-items: center;
  box-shadow: 0 4px 14px rgba(0,0,0,0.15);
}

.profile-avatar {
  width: 70px;
  height: 70px;
  background: white;
  color: #7a004b;
  font-size: 35px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  font-weight: bold;
  margin-left: 15px;
}

.profile-info h3 {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
}

.profile-info p {
  margin: 5px 0;
  font-size: 15px;
  opacity: 0.9;
}

.section-title {
  color: #7a004b;
  font-size: 20px;
  margin-bottom: 10px;
  font-weight: 700;
}

.order-box {
  background: white;
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 12px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  border-right: 6px solid #7a004b;
}




.order-box p { margin: 4px 0; }

.status-badge {
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 700;
  color: white;
  display: inline-block;
}

.st-new { background: #0288d1; }
.st-preparing { background: #ff9800; }
.st-completed { background: #4caf50; }
.st-out { background: #7a004b; }
.st-cancelled { background: #f44336; }

.logout-btn {
  width: 100%;
  background: #E91E63;
  color: white;
  border: none;
  padding: 14px;
  border-radius: 10px;
  font-size: 17px;
  cursor: pointer;
  margin-top: 25px;
  font-weight: bold;
}
.logout-btn:hover {
  opacity: 0.85;
}
.track-container {
  max-width: 600px;
  margin: 40px auto;
  background: white;
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.12);
  font-family: 'Cairo', sans-serif;
}

.track-title {
  text-align: center;
  font-size: 24px;
  font-weight: 800;
  color: #7a004b;
  margin-bottom: 20px;
}

.track-info p {
  margin: 6px 0;
  font-size: 16px;
  color: #444;
}

.timeline {
  margin: 25px 0;
  border-right: 3px solid #eee;
  padding-right: 20px;
}

.step-item {
  position: relative;
  margin-bottom: 22px;
  padding-right: 10px;
}

.step-circle {
  width: 18px;
  height: 18px;
  background: #ccc;
  border-radius: 50%;
  position: absolute;
  right: -29px;
  top: 3px;
  border: 3px solid #fff;
  box-shadow: 0 0 3px rgba(0,0,0,0.3);
}

.step-active .step-circle {
  background: #e91e63;
  box-shadow: 0 0 6px rgba(233, 30, 99, 0.7);
}

.step-text {
  font-size: 16px;
  font-weight: 600;
  color: #444;
}

.step-active .step-text {
  color: #e91e63;
}

.items-title {
  margin-top: 30px;
  font-size: 20px;
  color: #7a004b;
  font-weight: 700;
}

.item-card {
  background:#fafafa;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  border-right:5px solid #7a004b;
}

.item-card b { color:#333; }

.price-row {
  min-height: 25px; /* Ø«Ø§Ø¨Øª */
  display: flex;
  align-items: center;
  gap: 8px;
  flex-direction: row-reverse;
}

.order-card {
  background: #fff;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 10px;
  border: 1px solid #ddd;
}


.qty-btn {
  background:#E91E63;
  color:white;
  border:none;
  width:32px;
  height:32px;
  border-radius:8px;
  font-size:18px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  font-weight:bold;
}

.qty-btn:hover{
  opacity:0.8;
}

.step {
  padding: 12px;
  margin-bottom: 10px;
  background: #eee;
  border-radius: 8px;
  font-weight: 600;
  color: #444;
  border-right: 6px solid #aaa;
}

.active-step {
  background: #e91e63;
  color: white;
  border-right: 6px solid #7a004b;
}


/* ===================== Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ===================== */
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Cairo',sans-serif;
  background:#f2f2f5;
  color:#333;
}
.container{
  width:94%;
  max-width:1200px;
  margin:auto;
}

/* ===================== Ø§Ù„Ù‡ÙŠØ¯Ø± ===================== */
header{
  background:#fff;
  border-bottom:1px solid #e5e5e5;
  padding:12px 0;
  position:sticky;
  top:0;
  z-index:100;
}
.nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.logo{
  display:flex;
  align-items:center;
  gap:10px;
}
.logo-circle{
  width:48px;
  height:48px;
  border-radius:50%;
  background:#E91E63;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:20px;
  font-weight:700;
}
.nav-links a{
  margin:0 12px;
  text-decoration:none;
  color:#333;
  font-weight:500;
}
.nav-links a:hover{color:#E91E63;}
/*-------------------- Ø´ÙƒÙ„ Ø§Ù„ÙƒØ§Ø±Øª Ø¨Ø§Ù„Ø§Ø®Øµ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª -----------*/
.discount-label{
  position:absolute;
  top:10px;
  right:10px;
  background:#e91e63;
  color:#fff;
  padding:3px 8px;
  font-size:12px;
  border-radius:8px;
}

.price-box{
  margin-top:6px;
}

.old-price{
  font-size:13px;
  color:#999;
  text-decoration:line-through;
  margin-bottom:3px;
}

.new-price{
  font-size:17px;
  font-weight:bold;
  color:#d00055;
}

/* ===================== Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ===================== */
.categories{
  background:#fff;
  padding:14px 0;
  margin-top:10px;
  border-radius:14px;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
  display:flex;
  overflow-x:auto;
  gap:14px;
  white-space:nowrap;
}
.cat{
  background:#f9d9e6;
  border-radius:30px;
  padding:8px 18px;
  font-size:14px;
  cursor:pointer;
  color:#8a004a;
  font-weight:600;
}
.cat:hover{background:#f5c2d8;}

/* ===================== Ø³Ù„Ø§ÙŠØ¯Ø± ===================== */
.slider{
  margin-top:25px;
  border-radius:16px;
  overflow:hidden;
  height:180px;
  background:#ccc;
}

/* ===================== Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ===================== */
.section-title{
  font-size:22px;
  font-weight:700;
  margin:25px 0 10px;
  color:#8a004a;
}

/* ===================== Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===================== */
/* Ø´Ø¨ÙƒØ© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (ÙƒØ§Ø±ØªÙŠÙ† ÙÙŠ Ø§Ù„ØµÙ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„) */
.products-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  padding: 5px 0;
}

/* Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø¨Ù„Øª */
@media (min-width: 768px) {
  .products-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
@media (min-width: 1024px) {
  .products-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒØ§Ø±Øª */
.product-card {
  background: #ffffff;
  border-radius: 16px;
  padding: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: 0.2s;
}

.product-card:hover {
  transform: scale(1.03);
}

.product-img {
  width: 100%;
  height: 160px;
  object-fit: contain;
}

.product-card{
  background:#ffffff;
  border-radius:16px;
  padding:14px;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  position:relative;
  transition:0.25s ease-in-out;
  cursor: pointer;
}
.product-card:hover{
  transform:scale(1.04);
  box-shadow:0 6px 16px rgba(0,0,0,0.10);
}
.product-img{
  width:100%;
  height:180px;
  object-fit:contain;
  margin-bottom:8px;
}
.discount-label{
  background:#E91E63;
  color:#fff;
  display:inline-block;
  padding:3px 10px;
  font-size:12px;
  border-radius:20px;
  margin-bottom:6px;
  font-weight:600;
}
.product-name{
  font-size:14px;
  font-weight:600;
  color:#333;
  height:40px;
  overflow:hidden;
  margin-bottom:8px;
}
.price-final{
  font-size:18px;
  font-weight:800;
  color:#d60000;
}
.price-original{
  font-size:13px;
  text-decoration:line-through;
  color:#999;
  margin-bottom:6px;
}
.add-cart{
  background:#E91E63;
  color:#fff;
  border:none;
  width:100%;
  margin-top: auto;
  padding:8px 0;
  border-radius:10px;
  font-size:14px;
  cursor:pointer;
  font-weight:600;
}
.add-cart:hover{opacity:0.9;}

.more-btn{
  display:block;
  margin:20px auto;
  background:#8a004a;
  color:#fff;
  padding:10px 20px;
  font-size:14px;
  border-radius:12px;
  cursor:pointer;
  border:none;
}
.add-cart.added {
  background:#8a004a !important;
  color:white !important;
  transform:scale(1.05);
  transition:0.2s;
}
#productAddBtn {
  background: #E91E63;
  color: white;
  border: none;
  border-radius: 12px;
  padding: 12px 25px;
  font-size: 16px;
  cursor: pointer;
  transition: 0.25s ease-in-out;
}

#productAddBtn:hover {
  opacity: 0.9;
  transform: scale(1.03);
}
#productAddBtn.added {
  background: #8a004a !important;
  color: white !important;
}


/* ===================== Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª ===================== */
.brands-wrapper{
  position:relative;
  margin:20px 0 30px;
}
.brands-slider{
  display:flex;
  gap:20px;
  justify-content:center;
  overflow-x:auto;
  scroll-behavior:smooth;
  padding:10px 5px;
}
.brands-slider::-webkit-scrollbar{
  height:6px;
}
.brands-slider::-webkit-scrollbar-thumb{
  background:#e7b2c8;
  border-radius:10px;
}
.brand-box{
  min-width:110px;
  text-align:center;
  cursor:pointer;
  transition:0.3s;
}
.brand-box:hover{
  transform:scale(1.05);
}
.brand-circle{
  width:85px;
  height:85px;
  border-radius:50%;
  overflow:hidden;
  background:#fff;
  border:2px solid #f2bfd7;
  margin:auto;
}
.brand-circle img{
  width:100%;
  height:100%;
  object-fit:contain;
  padding:10px;
}
.brand-name{
  margin-top:8px;
  font-size:14px;
  font-weight:600;
  color:#8a004a;
}
.brand-arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:#e91e63;
  border:none;
  color:#fff;
  font-size:24px;
  width:35px;
  height:35px;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  justify-content:center;
  align-items:center;
}
.brand-arrow.left{ left:-10px; }
.brand-arrow.right{ right:-10px; }
.brand-arrow:hover{ background:#c2185b; }

/* ===================== Ø§Ù„Ø³Ù„Ø© ===================== */
#cartOverlay{
  position:fixed;left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,0.55);z-index:999;display:none;
}
#cartPanel{
  position:fixed;top:0;right:-340px;width:320px;height:100%;
  background:#fff;z-index:1000;box-shadow:-3px 0 10px rgba(0,0,0,0.2);
  padding:20px;transition:0.3s;display:flex;flex-direction:column;
}
/* ===================== ØµÙØ­Ø© Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ===================== */
.checkout-box{
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
  margin-bottom:20px;
}

.checkout-title{
  font-size:18px;
  color:#8a004a;
  font-weight:700;
  margin-bottom:15px;
}

.checkout-input{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:10px;
  margin-bottom:12px;
  font-size:15px;
}

.checkout-btn-pink{
  background:#E91E63;
  color:white;
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:17px;
  font-weight:bold;
  margin-bottom:10px;
}

.checkout-btn-blue{
  background:#00AEEF;
  color:white;
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:17px;
  font-weight:bold;
  margin-bottom:10px;
}

.checkout-btn-back{
  background:#8a004a22;
  color:#8a004a;
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:17px;
  font-weight:bold;
}
/* ====================== Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬ÙˆØ§Ù„ ====================== */

/* Ø¥Ø®ÙØ§Ø¡ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 768px) {
  .nav-links,
  #mainHeader .logo div:last-child {  /* Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø¬Ù…Ø§Ù„Ùƒ ÙˆØ§Ù„Ø§ÙƒØªÙØ§Ø¡ Ø¨Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¬ */
    display: none !important;
  }

  /* ØªØµØºÙŠØ± Ø§Ù„Ù‡ÙŠØ¯Ø± */
  header .nav {
    gap: 10px;
  }

  /* Ø²Ø± Ø§Ù„Ù…Ù†ÙŠÙˆ */
  #menuBtn {
    display: block !important;
    font-size: 26px;
    cursor: pointer;
    padding: 6px 10px;
    color: #8a004a;
  }
}

/* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ (Ø¯ÙŠØ³ÙƒØªÙˆØ¨) */
#menuBtn {
  display: none;
}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
#sideMenu {
  position: fixed;
  top: 0;
  right: -260px;
  width: 250px;
  height: 100%;
  background: #ffffff;
  box-shadow: -3px 0 10px rgba(0,0,0,0.15);
  padding: 20px;
  z-index: 2000;
  transition: 0.3s;
}

#sideMenu a {
  display: block;
  padding: 12px 0;
  font-size: 18px;
  color: #8a004a;
  text-decoration: none;
  border-bottom: 1px solid #eee;
}

#sideMenu a:hover {
  color: #E91E63;
}

/* Ø®Ù„ÙÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
#menuOverlay {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.4);
  display:none;
  z-index:1500;
}

/* ===================== Ø§Ù„ØµÙØ­Ø§Øª ===================== */
.page{ display:none; }
.page.active{ display:block; }

/* ===================== Ø§Ù„ÙÙˆØªØ± ===================== */
.footer{background:#ffffff;margin-top:40px;padding:35px 0 0;border-top:3px solid #f2bfd7;}
.footer-container{
  width:94%;max-width:1200px;margin:auto;
  display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:30px;
}
.footer-bottom{
  text-align:center;padding:12px 0;margin-top:20px;
  background:#fce4ef;color:#8a004a;font-size:14px;
}
/* Ø³Ù„Ø© Ù…Ø­Ø³Ù‘Ù†Ø© */
#cartPanel {
  border-top-left-radius: 20px;
  border-bottom-left-radius: 20px;
  box-shadow: -4px 0 18px rgba(0,0,0,0.15);
  backdrop-filter: blur(10px);
}

.cart-item-img {
  width: 55px;
  height: 55px;
  border-radius: 10px;
  object-fit: cover;
}
@media print {

  /* Ø§Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø© ÙƒØ§Ù…Ù„Ø© */
  body * {
    visibility: hidden !important;
  }

  /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙ‚Ø· */
  #invoiceBox, 
  #invoiceBox * {
    visibility: visible !important;
  }

  /* Ø¬Ø¹Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ…Ù„Ø£ ØµÙØ­Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
  #invoiceBox {
    position: absolute;
    top: 0;
    right: 0;
    width: 100% !important;
    padding: 25px;
    background: white !important;
  }

  /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ± */
  header, footer {
    display: none !important;
  }

  /* Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© */
  * {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}

</style>

</head>

<body>

<!-- =========================  Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø³ÙŠØªÙ… Ø¯Ù…Ø¬Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ) ========================= -->

<header id="mainHeader">
  <div class="container">
    <div class="nav">

      <!-- Ø§Ù„Ø´Ø¹Ø§Ø± -->
      <div class="logo" onclick="go('home')" style="cursor:pointer;">
        <div class="logo-circle">Ø¬</div>
        <div style="font-size:20px;font-weight:700;color:#8a004a">Ø¬Ù…Ø§Ù„Ùƒ</div>
      </div>

      <!-- Ø±ÙˆØ§Ø¨Ø· -->
      <div class="nav-links">
        <a href="#" onclick="go('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#" onclick="go('products')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
        <a href="#" onclick="go('brands')">Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</a>
        <a href="#" onclick="go('profile')">Ø­Ø³Ø§Ø¨ÙŠ</a>
		<a href="#" onclick="go('offers')">Ø§Ù„Ø¹Ø±ÙˆØ¶</a>
        <a href="#" onclick="go('categories')">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a>
		<a href="#" onclick="go('wishlist')">Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª</a>


      </div>
<div style="flex:1;display:flex;justify-content:center;">
  <div style="position:relative;width:100%;max-width:280px;">
    <input 
      id="headerSearch"
      oninput="headerLiveSearch()"
      placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬â€¦" 
      style="
        width:100%;
        padding:8px 12px 8px 35px;
        border-radius:20px;
        border:1px solid #ddd;
        font-size:14px;
        transition:0.2s;
      "
    />

    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø­Ø« -->
    <span style="
      position:absolute;
      left:10px;
      top:50%;
      transform:translateY(-50%);
      font-size:18px;
      color:#8a004a;
    ">ğŸ”</span>

    <!-- ØµÙ†Ø¯ÙˆÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
    <div id="headerSearchResults"
         style="
          position:absolute;
          top:42px;
          width:100%;
          background:#fff;
          border-radius:12px;
          border:1px solid #eee;
          box-shadow:0 4px 12px rgba(0,0,0,0.08);
          z-index:9999;
          max-height:260px;
          overflow-y:auto;
          display:none;
        ">
    </div>
  </div>
</div>

      <!-- Ø²Ø± Ø§Ù„Ù…Ù†ÙŠÙˆ Ù„Ù„Ø¬ÙˆØ§Ù„ -->
<div id="menuBtn" onclick="openMenu()">â˜°</div>

      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù„Ø© -->
      <div onclick="openCart()" style="cursor:pointer;font-size:22px;color:#8a004a;position:relative;">
  ğŸ›’
  <span id="cartCount"
        style="
          position:absolute;
          top:-6px;
          right:-10px;
          background:#E91E63;
          color:white;
          padding:2px 6px;
          border-radius:50%;
          font-size:12px;
          display:none;
        ">
  </span>
</div>


    </div>
  </div>
</header>

<!--  Ù„Ù„Ø¬ÙˆØ§Ù„ Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
<div id="menuOverlay" onclick="closeMenu()"></div>

<!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
<div id="sideMenu">
  <a href="#" onclick="go('home'); closeMenu()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="#" onclick="go('products'); closeMenu()">ğŸ› Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
  <a href="#" onclick="go('brands'); closeMenu()">â­ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</a>
  <a href="#" onclick="go('offers'); closeMenu()">ğŸ Ø§Ù„Ø¹Ø±ÙˆØ¶</a>
  <a href="#" onclick="go('categories'); closeMenu()">ğŸ“‚ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a>
  <a href="#" onclick="go('wishlist'); closeMenu()">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª</a>
  <a href="#" onclick="go('profile'); closeMenu()">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</a>
</div>


<!-- ========================= Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø«Ø§Ø¨ØªØ©) ========================= -->

<!-- Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ -->
<div id="cartOverlay" onclick="closeCart()" style="display:none;"></div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø³Ù„Ø© -->
<div id="cartPanel">

  <h2 style="color:#8a004a;margin-bottom:10px;">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>

  <!-- Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
  <div id="cartItems" style="flex:1;overflow-y:auto;margin-bottom:10px;"></div>

  <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
  <div style="font-size:18px;font-weight:700;margin-bottom:15px;color:#8a004a;">
    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cartTotal">0</span> Ø±.Ø³
  </div>

  <!-- Ø²Ø± Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø¯ÙØ¹ -->
  <button onclick="checkBeforeCheckout()" 
          style="background:#E91E63;color:white;width:100%;margin-bottom:5px;padding:10px;border:none;border-radius:10px;font-size:16px;font-weight:700;">
    Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
  </button>
<button onclick="closeCart()"
        style="background:#eee;color:#333;width:100%;padding:10px;border:none;border-radius:10px;font-size:15px;margin-bottom:8px;">
  Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚
</button>

</div>



<!-- ========================= Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª SPA ========================= -->

<div id="app">
<!-- ØµÙØ­Ø© Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª -->
<section id="page-wishlist" class="page">
  <div class="container">
    <h2 class="section-title">Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª â¤ï¸</h2>
    <div id="wishlistGrid" class="products-grid"></div>
  </div>
</section>

  <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Home) -->
  <section id="page-home" class="page active">


  <div class="container">

    <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <div class="categories">
      <div class="cat" onclick="go('products')">Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©</div>
      <div class="cat" onclick="go('products')">Ù…ÙƒÙŠØ§Ø¬ Ø§Ù„ÙˆØ¬Ù‡</div>
      <div class="cat" onclick="go('products')">Ù…ÙƒÙŠØ§Ø¬ Ø§Ù„Ø¹ÙŠÙˆÙ†</div>
      <div class="cat" onclick="go('products')">Ø§Ù„Ø´ÙØ§Ù‡</div>
      <div class="cat" onclick="go('products')">Ø§Ù„Ø¹Ø·ÙˆØ±</div>
      <div class="cat" onclick="go('products')">Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
      <div class="cat" onclick="go('products')">Ø§Ù„Ø¹Ø±ÙˆØ¶</div>
    </div>

    <!-- Ø³Ù„Ø§ÙŠØ¯Ø± -->
    <div class="slider">
      <img src="https://i.imgur.com/UAp8b9b.jpeg"
           style="width:100%;height:100%;object-fit:cover;">
    </div>

    <!-- Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª -->
    <h2 class="section-title">Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª â­</h2>
    <div class="brands-wrapper">
      <button class="brand-arrow left" onclick="scrollBrands(-300)">â€¹</button>
      <div id="brandsSlider" class="brands-slider"></div>
      <button class="brand-arrow right" onclick="scrollBrands(300)">â€º</button>
    </div>

    <!-- Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© -->
    <h2 class="section-title">Ù…Ù†ØªØ¬Ø§Øª Ù…Ø®ØªØ§Ø±Ø© âœ¨</h2>
    <div id="featuredGrid" class="products-grid"></div>

    <!-- Ø¹Ø±ÙˆØ¶ -->
    <h2 class="section-title">Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ© ğŸ’—</h2>
    <div id="discountGrid" class="products-grid"></div>

    <button class="more-btn" onclick="go('products')">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</button>

  </div>

</section>


  <!-- ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<section id="page-products" class="page">

  <div class="container">

    <h2 class="section-title">ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>

    <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
    <input id="productsSearch"
           placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬â€¦"
           style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-bottom:15px;"
           oninput="filterProducts()">

    <!-- ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø±ÙƒØ© -->
    <select id="brandSelect"
            onchange="filterProducts()"
            style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-bottom:20px;">
      <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</option>
    </select>

    <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div id="productsPageGrid" class="products-grid"></div>

  </div>

</section>


  <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
<section id="page-product" class="page">

  <div class="container" id="productDetailsBox" style="min-height:400px;padding:20px;">

    <!-- Ø³ÙŠØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->

  </div>

</section>


  <!-- Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª -->
  <section id="page-brands" class="page">
  <div class="container">

    <h2 class="section-title">Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</h2>

    <div id="brandsGrid" 
         style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:20px;">
    </div>

  </div>
</section>


  <!-- Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø§Ø±ÙƒØ© -->
<section id="page-brand" class="page">
  <div class="container">
    <h2 class="section-title" id="brandTitle">Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø§Ø±ÙƒØ©</h2>
    <div id="brandProductsGrid" class="products-grid"></div>
  </div>
</section>


  <!-- Ø§Ù„Ø³Ù„Ø© / Ø§Ù„Ø¯ÙØ¹ -->
<section id="page-checkout" class="page">
  <div class="container" style="max-width:650px;margin:auto;padding:20px;">

    <h2 style="text-align:center;color:#8a004a;font-size:24px;font-weight:800;margin-bottom:20px;">
      Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
    </h2>

    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <div class="checkout-box">
      <h3 class="checkout-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>

      <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
      <input id="co_name" class="checkout-input" readonly>

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input id="co_phone" class="checkout-input" readonly>


      <label>Ø±Ù‚Ù… Ø¢Ø®Ø± Ù„Ù„ØªÙˆØ§ØµÙ„</label>
      <input id="co_phone2" class="checkout-input">

      <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
      <input id="co_address" class="checkout-input">

      <button onclick="pickLocation()" class="checkout-btn-blue" style="margin-bottom:10px;">
        ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
      </button>

      <input id="co_location" class="checkout-input" readonly placeholder="Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯">

      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea id="co_notes" class="checkout-input" style="height:80px;"></textarea>
    </div>

    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª + Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ÙƒØ±Øª -->
    <div class="checkout-box" id="checkoutItems"></div>

    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
    <button onclick="sendWhatsAppOrder()" class="checkout-btn-pink">
      Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
    </button>

    <button onclick="payOnline()" class="checkout-btn-blue">
      Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    </button>

    <button onclick="go('home')" class="checkout-btn-back">
      â—€ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚
    </button>

  </div>
</section>


<section id="page-track" class="page">

  <div class="track-container">

    <div class="track-title">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</div>

    <div class="track-info" id="trackInfo">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

    <div class="timeline" id="timeline"></div>

    <div class="items-title">Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
    <div id="trackItems"></div>

  </div>

</section>




  <!-- ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„-->
<section id="page-thanks" class="page">
  <div class="container" style="max-width:750px;margin:auto;padding:25px;">

    <h2 style="text-align:center;color:#8a004a;font-weight:900;">ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨</h2>

    <div id="invoiceBox" style="
      background:#fff;
      padding:20px;
      border-radius:15px;
      box-shadow:0 0 10px rgba(0,0,0,0.1);
      margin-top:20px;
    ">
      <p style="text-align:center;color:#777;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©...</p>
    </div>

    <button onclick="printInvoice()" 
      style="display:block;width:100%;margin-top:25px;background:#8a004a;color:white;padding:12px;border:none;border-radius:10px;font-size:18px;">
      ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    </button>

    <button onclick="go('home')" 
      style="display:block;width:100%;margin-top:15px;background:#E91E63;color:white;padding:12px;border:none;border-radius:10px;font-size:18px;">
      â—€ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </button>

  </div>
</section>








  <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <section id="page-login" class="page">
  <div class="container" style="max-width:400px;margin:auto;padding:20px;">

    <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

    <input id="loginPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„"
           style="width:100%;padding:10px;border-radius:10px;margin-bottom:10px;border:1px solid #ddd;">

    <input id="loginPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
           style="width:100%;padding:10px;border-radius:10px;margin-bottom:10px;border:1px solid #ddd;">

    <button onclick="doLogin()"
            style="background:#E91E63;color:white;width:100%;padding:10px;border:none;border-radius:12px;font-size:16px;">
      Ø¯Ø®ÙˆÙ„
    </button>
<p style="text-align:center;margin-top:10px;">
  <a href="#" onclick="go('forgot')" style="color:#8a004a;">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
</p>

    <div id="loginMsg" style="margin-top:15px;color:red;"></div>
<p style="text-align:center;margin-top:10px;">
  Ù„Ø§ ØªÙ…Ù„Ùƒ Ø­Ø³Ø§Ø¨Ø§Ù‹ØŸ 
  <a href="#" onclick="go('register')" style="color:#E91E63;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
</p>

  </div>
</section>
<!-- ØµÙØ­Ø© Ù†Ø³ÙŠØ§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
<section id="page-forgot" class="page">
  <div style="max-width:400px;margin:auto;padding:25px;">
    <h2 class="section-title">Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>

    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input id="fpEmail" type="email"
           placeholder="example@gmail.com"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <button onclick="sendResetCode()"
            style="background:#8a004a;color:white;width:100%;padding:14px;border:none;border-radius:12px;font-size:17px;">
      Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
    </button>

    <div id="fpMsg" style="margin-top:15px;color:red;text-align:center;"></div>

    <p style="margin-top:15px;text-align:center;">
      <a href="#" onclick="go('login')" style="color:#E91E63;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
    </p>
  </div>
</section>
<!-- ØµÙØ­Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
<section id="page-reset" class="page">
  <div style="max-width:400px;margin:auto;padding:25px;">

    <h2 class="section-title">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>

    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input id="rpEmail" type="email"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <label>ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</label>
    <input id="rpCode" 
           placeholder="XXXXXX"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</label>
    <input id="rpPass" type="password"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <button onclick="resetPassword()"
            style="background:#8a004a;color:white;width:100%;padding:14px;border:none;border-radius:12px;font-size:17px;">
      Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    </button>

    <div id="rpMsg" style="margin-top:15px;color:red;text-align:center;"></div>

  </div>
</section>
<!-- ØµÙØ­Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
<section id="page-verify" class="page">
  <div style="max-width:400px;margin:auto;padding:25px;">

    <h2 class="section-title">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h2>

    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
    <input id="vPhone"
           readonly
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <label>ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</label>
    <input id="vCode" placeholder="XXXXXX"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <button onclick="verifyAccount()"
            style="background:#8a004a;color:white;width:100%;padding:14px;border:none;border-radius:12px;font-size:17px;">
      ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
    </button>

    <div id="verifyMsg"
         style="margin-top:15px;color:red;text-align:center;"></div>

    <!-- Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ -->
    <p style="margin-top:15px;text-align:center;">
      <span id="resendBox">
        <a href="#" onclick="resendVerifyCode()" style="color:#E91E63;">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯</a>
      </span>
      <span id="timerBox"
            style="display:none;color:#777;font-size:14px;">
        Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø®Ù„Ø§Ù„ <span id="timer">60</span> Ø«Ø§Ù†ÙŠØ©
      </span>
    </p>

  </div>
</section>


<!-- ØµÙØ­Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ -->
<!-- ØµÙØ­Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ (Ø¨Ø¯ÙˆÙ† Ø®Ø±ÙŠØ·Ø©) -->
<section id="page-register" class="page">
  <div style="max-width:450px;margin:auto;padding:25px;">

    <h2 class="section-title" style="text-align:center;margin-bottom:20px;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>

    <!-- Ø§Ù„Ø§Ø³Ù… -->
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
    <input id="regName" class="input"
           placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <!-- Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ -->
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
    <div style="display:flex;align-items:center;margin-bottom:12px;">
      <span style="background:#eee;padding:10px 14px;border-radius:12px 0 0 12px;font-weight:bold;">
        ğŸ‡¸ğŸ‡¦ +966
      </span>
      <input id="regPhone" class="input"
             placeholder="5xxxxxxxx"
             style="flex:1;padding:12px;border-radius:0 12px 12px 0;border:1px solid #ddd;">
    </div>

    <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ -->
    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input id="regEmail" class="input" type="email"
           placeholder="example@gmail.com"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="regPass" type="password" class="input"
           placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <!-- Ø¥Ø¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <label>Ø¥Ø¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="regPass2" type="password" class="input"
           placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
    <input id="regAddress" class="input"
           placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø¯Ø© - Ø­ÙŠ Ø§Ù„Ø­Ù…Ø¯Ø§Ù†ÙŠØ© - Ø´Ø§Ø±Ø¹ Ø³Ø¹ÙŠØ¯"
           style="width:100%;padding:12px;border-radius:12px;border:1px solid #ddd;margin-bottom:12px;">

    <button onclick="doRegister()"
            style="background:#8a004a;color:white;width:100%;padding:14px;border:none;border-radius:12px;font-size:17px;margin-top:10px;">
      Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
    </button>

    <div id="registerMsg" style="margin-top:15px;color:red;text-align:center;"></div>

    <p style="margin-top:15px;text-align:center;">
      Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="go('login')" style="color:#E91E63;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
    </p>

  </div>
</section>





  <!-- ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <section id="page-profile" class="page">
  <div class="profile-container">

  <div class="profile-card">
    <div class="profile-avatar">ğŸ‘¤</div>
    <div class="profile-info">
      <h3 id="pName">â€”</h3>
      <p id="pPhone">â€”</p>
      <p id="pEmail">â€”</p>
      <p id="pAddress">â€”</p>
    </div>
  </div>

  <h3 class="section-title">Ø·Ù„Ø¨Ù€Ù€Ù€Ø§ØªÙŠ</h3>

  <div id="profileOrders"></div>

  <button class="logout-btn" onclick="logoutUser()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

</div>

  <div class="container" style="padding:20px;">

    <h2 class="section-title">Ø­Ø³Ø§Ø¨ÙŠ</h2>

    <div id="profileBox" style="font-size:18px;color:#444;"></div>

  </div>
</section>
<!-- ØµÙØ­Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ -->
<section id="page-offers" class="page">
  <div class="container">
    <h2 class="section-title">ğŸ’— Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ©</h2>

    <div id="offersGrid" class="products-grid"></div>

  </div>
</section>

<!-- ØµÙØ­Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
<section id="page-categories" class="page">
  <div class="container">

    <h2 class="section-title">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h2>

    <div id="categoriesList" 
         style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:20px;">
    </div>

  </div>
</section>
<!-- ØµÙØ­Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙ -->
<section id="page-category" class="page">
  <div class="container">

    <h2 class="section-title" id="categoryTitle"></h2>

    <div id="categoryGrid" class="products-grid"></div>

  </div>
</section>

</div>


<!-- ========================= Ø§Ù„ÙÙˆØªØ± ========================= -->
<footer class="footer" id="mainFooter">
  <div class="footer-container">

    <div>
      <h3 style="color:#8a004a;margin-bottom:10px;">Ø¬Ù…Ø§Ù„Ùƒ</h3>
      <p>Ù…ØªØ¬Ø± Ù…ØªØ®ØµØµ ÙÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙŠØ© ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠØ©.</p>
    </div>

    <div>
      <h3 style="color:#8a004a;margin-bottom:10px;">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
      <p><a href="#" onclick="go('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></p>
      <p><a href="#" onclick="go('products')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></p>
      <p><a href="#" onclick="go('brands')">Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</a></p>
      <p><a href="#" onclick="go('track')">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</a></p>
    </div>

    <div>
      <h3 style="color:#8a004a;margin-bottom:10px;">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h3>
      <p>ğŸ“ 055-555-5555</p>
      <p>ğŸ“§ info@beauty.com</p>
    </div>

  </div>

  <div class="footer-bottom">
    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 Ù…ØªØ¬Ø± Ø¬Ù…Ø§Ù„Ùƒ
  </div>
</footer>



<!-- ========================= ÙƒÙˆØ¯ SPA Router ========================= -->

<script>
async function loadProductsCache() {
  if (!window.productsCache) {
    const res = await fetch(API + "/api/admin/products");
    window.productsCache = await res.json();
  }
}

function safeImageURL(url) {
  if (!url || url.trim() === "" || url.length < 10) {
    return "https://via.placeholder.com/300x300?text=No+Image";
  }

  url = url.trim();

  // Google Drive
  if (url.includes("drive.google.com")) {
    const id = url.match(/[-\w]{25,}/);
    return id ? `https://lh3.googleusercontent.com/d/${id[0]}` : "https://via.placeholder.com/300x300?text=No+Image";
  }

  // Googleusercontent direct image
  if (url.includes("googleusercontent.com")) {
    return url;
  }

  // Full HTTP/HTTPS link
  if (url.startsWith("http://") || url.startsWith("https://")) {
    return url;
  }

  // If it's not a link â†’ return a placeholder
  return "https://via.placeholder.com/300x300?text=No+Image";
}



function go(page, data = null) {
  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª
  document.querySelectorAll(".page").forEach(
    p => p.classList.remove("active")
  );

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  const targetPage = document.getElementById("page-" + page);
  if (targetPage) targetPage.classList.add("active");
	
  // ğŸ”¥ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  if(page === "login") closeCart();
  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©

  if (page === "home") loadHome();
  if (page === "products") loadAllProducts();
  if (page === "product") loadProductDetails(data);
  if (page === "brands") loadBrandsList();

  if (page === "brand") {
    window.currentBrand = data;
    loadBrandProducts(data);
  }

  if(page === "checkout") {
    renderCheckoutPage();
    autoFillUserInCheckout();   // â­ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ù‡Ù†Ø§
}


  // â­ Ø¥ØµÙ„Ø§Ø­ track (Ù…Ø´Ø±ÙˆØ· Ø¨ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙØ­Ø©)
  if (page === "track" && document.getElementById("page-track")) {
  loadTrackPage(data);   // â† Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
}


  // â­ Ø¥ØµÙ„Ø§Ø­ offers (Ù…Ø´Ø±ÙˆØ· Ø¨ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙØ­Ø©)
  if (page === "offers" && document.getElementById("page-offers")) {
    loadOffers();
  }

  if (page === "categories") loadCategories();

  if (page === "category") {
    window.currentCategory = data;
    loadCategoryProducts(data);
  }

  if (page === "thanks") {
    loadInvoice(data);   // â† Ù‡Ù†Ø§ Ù†Ø­Ù…Ù‘Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
}


  if (page === "wishlist") loadWishlist();

  // â­ ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ÙŠ
  if (page === "profile" && typeof loadProfile === "function") {
    loadProfile();
  }
}





const API = "https://gamalek.onrender.com";
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø¹Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
window.user = JSON.parse(localStorage.getItem("user") || "null");


// ======================= ØµÙØ­Ø© ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =======================
async function loadAllProducts(){

  // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  const res = await fetch(API + "/api/admin/products");
  const list = await res.json();

  // Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
  window.allProducts = list;
  window.productsCache = list;

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙ„ØªØ± (Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª)
  fillBrandSelect();

  // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  renderProducts(list);

  // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ù„Ø©
  refreshAllAddToCartButtons();
}



function fillBrandSelect(){
  const sel = document.getElementById("brandSelect");
  sel.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</option>';

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
  let brands = {};
  allProducts.forEach(p => {
    if(p.brand_id && !brands[p.brand_id]){
      brands[p.brand_id] = p.brand_name;
    }
  });

  for(let id in brands){
    sel.innerHTML += `<option value="${id}">${brands[id]}</option>`;
  }
}

function renderProducts(list){
  const grid = document.getElementById("productsPageGrid");
  grid.innerHTML = "";
	// â­ ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ ØªÙˆÙØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
list.sort((a, b) => {
  if (a.stock_qty == 0 && b.stock_qty > 0) return 1;
  if (a.stock_qty > 0 && b.stock_qty == 0) return -1;
  return 0;
});


  if(list.length === 0){
    grid.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>";
    return;
  }

  list.forEach(p=>{
    grid.innerHTML += makeProductCard(p);
  });

  refreshAllAddToCartButtons();   // âœ” Ù‡Ù†Ø§ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­
}



function filterProducts(){
  const text = document.getElementById("productsSearch").value.toLowerCase();
  const brand = document.getElementById("brandSelect").value;

  let filtered = allProducts.filter(p=>
    (!text || p.name.toLowerCase().includes(text)) &&
    (!brand || p.brand_id == brand)
  );

  renderProducts(filtered);
}
//------------------ ØµÙØ­Ø© Ø®ØµÙ… Ø§Ù„Ø³Ø¹Ø± --------------------
function calculateFinalPrice(p){
  const base = parseFloat(p.base_price) || 0;
  const discountValue = parseFloat(p.discount_value) || 0;
  const discountType = p.discount_type || "none";

  let priceAfterDiscount = base;

  // Ø§Ù„Ø®ØµÙ…
  if(discountType === "percent"){
    priceAfterDiscount = base - (base * (discountValue / 100));
  }
  else if(discountType === "fixed"){
    priceAfterDiscount = base - discountValue;
  }

  if(priceAfterDiscount < 0) priceAfterDiscount = 0;

  // Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 15%
  const beforeVat = base * 1.15;
  const finalWithVat = priceAfterDiscount * 1.15;

  return {
    before: beforeVat.toFixed(2),     // Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ… + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
    final: finalWithVat.toFixed(2),   // Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
  };
}



// ======================= ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ =======================
// ======================= ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ =======================
async function loadProductDetails(id) {
// ğŸŸ£ Skeleton Loader â€” ÙŠÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø³Ø§Ø¨Ù‚
document.getElementById("productDetailsBox").innerHTML = `
  <div style="display:flex;gap:20px;flex-wrap:wrap;">

    <!-- ØµÙˆØ±Ø© Ø±Ù…Ø§Ø¯ÙŠØ© -->
    <div style="flex:1;min-width:260px;">
      <div style="
        width:100%;
        height:320px;
        background:#e4e4e4;
        border-radius:16px;
        animation:pulse 1.4s infinite;">
      </div>
    </div>

    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø±Ù…Ø§Ø¯ÙŠØ© -->
    <div style="flex:2;min-width:260px;">
      <div style="height:28px;background:#e4e4e4;border-radius:8px;width:70%;margin-bottom:15px;animation:pulse 1.4s infinite;"></div>
      <div style="height:20px;background:#e4e4e4;border-radius:8px;width:40%;margin-bottom:10px;animation:pulse 1.4s infinite;"></div>
      <div style="height:20px;background:#e4e4e4;border-radius:8px;width:90%;margin-bottom:10px;animation:pulse 1.4s infinite;"></div>
      <div style="height:20px;background:#e4e4e4;border-radius:8px;width:80%;margin-bottom:10px;animation:pulse 1.4s infinite;"></div>

      <div style="height:45px;background:#e4e4e4;border-radius:10px;width:150px;margin-top:25px;animation:pulse 1.4s infinite;"></div>
    </div>

  </div>

  <style>
    @keyframes pulse {
      0% { opacity:.6; }
      50% { opacity:1; }
      100% { opacity:.6; }
    }
  </style>
`;

  // â­ Ø¥ØµÙ„Ø§Ø­ Ù‚ÙØ² Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ø£Ø³ÙÙ„
  window.scrollTo(0, 0);
  const res = await fetch(API + "/api/admin/products");
  const products = await res.json();

  const p = products.find(x => x.id == id);
  if (!p) {
    document.getElementById("productDetailsBox").innerHTML =
      "<p>âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>";
    return;
  }

  /* â­ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± â­ */

  const base = parseFloat(p.base_price) || 0;               // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨Ø¯ÙˆÙ† Ø¶Ø±ÙŠØ¨Ø©
  const discountValue = parseFloat(p.discount_value) || 0;  // Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…
  const discountType = p.discount_type || "none";           // Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…

  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…
  let afterDiscount = base;
  if (discountType === "percent") {
    afterDiscount = base - (base * (discountValue / 100));
  }
  else if (discountType === "fixed") {
    afterDiscount = base - discountValue;
  }

  if (afterDiscount < 0) afterDiscount = 0;

  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 15%
  const beforeVat = base * 1.15;         // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
  const afterVat = afterDiscount * 1.15; // Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©

  /* â­ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ â­ */
  document.getElementById("productDetailsBox").innerHTML = `
    <div style="display:flex;gap:20px;flex-wrap:wrap;">

      <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
      <div style="flex:1;min-width:260px;">
        <img src="${safeImageURL(p.image_url)}"
        onerror="this.src='https://via.placeholder.com/400?text=No+Image'"
        style="width:100%;border-radius:16px;
        ${p.stock_qty == 0 ? 'filter:grayscale(100%);opacity:0.5;' : ''}">

      </div>

      <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
      <div style="flex:2;min-width:260px;">
        <h2 style="color:#8a004a;margin-bottom:10px;">${p.name}</h2>

        <!-- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
        <div style="margin:10px 0;">
          
          <!-- Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ… (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙŠÙˆØ¬Ø¯ Ø®ØµÙ…) -->
          ${(discountType !== "none" && discountValue > 0) ? `
            <div style="color:#999;text-decoration:line-through;font-size:18px;">
              ${beforeVat.toFixed(2)} Ø±.Ø³
            </div>
          ` : ""}

          <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
          <div style="font-size:24px;font-weight:800;color:#8a004a;margin-top:5px;">
            ${afterVat.toFixed(2)} Ø±.Ø³
          </div>

          <!-- Ø¨ÙŠØ§Ù† Ø§Ù„Ø®ØµÙ… -->
          ${(discountType !== "none" && discountValue > 0) ? `
            <div style="color:#0a7d00;font-weight:bold;font-size:14px;margin-top:5px;">
              Ø®ØµÙ…: ${discountType === "percent" ? discountValue + "%" : discountValue + " Ø±.Ø³"}
            </div>
          ` : ""}
          
        </div>

        <!-- Ø§Ù„ÙˆØµÙ -->
        <p style="line-height:1.8;color:#444;margin-top:15px;">
          ${p.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ù†ØªØ¬"}
        </p>

        <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© -->
   <button id="productAddBtn"
        data-id="${p.id}"
        ${p.stock_qty == 0 ? 'disabled style="opacity:0.4;cursor:not-allowed;background:#999;"' : ''}
        onclick="${p.stock_qty == 0 ? '' : `addToCart(${p.id})`}">  
        ${p.stock_qty == 0 ? "ØºÙŠØ± Ù…ØªÙˆÙØ±" : "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©"}
   </button>


      </div>

    </div>
  `;

  updateProductPageButton(id);

  
  /* ============================================================
   â­ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø© â€” Ø³Ù„Ø§ÙŠØ¯Ø± Ø£ÙÙ‚ÙŠ â­
   ============================================================ */
/* ============================================================
     â­ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© â€” Ø³Ù„Ø§ÙŠØ¯Ø± ÙƒØ§Ù…Ù„ â­
   ============================================================ */

let similar = (window.productsCache || [])
  .filter(x => x.category === p.category && x.id != p.id)
  .slice(0, 10); // ÙÙ‚Ø· Ø£ÙˆÙ„ 10 Ù…Ù†ØªØ¬Ø§Øª

if (similar.length > 0) {

  let sliderHTML = `
    <h3 style="margin-top:35px;color:#8a004a;font-size:22px;font-weight:800;">
      Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
    </h3>

    <div style="position:relative;margin-top:10px;">

      <!-- Ø²Ø± â† -->
      <button id="simPrev" 
        style="
          position:absolute;top:50%;right:-10px;transform:translateY(-50%);
          z-index:10;background:#8a004a;color:white;border:none;
          width:35px;height:35px;border-radius:50%;font-size:18px;cursor:pointer;">
        â€¹
      </button>

      <!-- Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± -->
      <div id="simSlider"
        style="
          display:flex;gap:15px;overflow-x:hidden;overflow-y:hidden;
    padding:10px 0;scroll-behavior:smooth;">
  `;

  similar.forEach(sp => {
    const prices = calculateFinalPrice(sp);

    sliderHTML += `
      <div onclick="go('product', ${sp.id})"
        style="
          min-width:180px;
          background:#fff;
          border-radius:14px;
          box-shadow:0 2px 6px rgba(0,0,0,0.08);
          padding:12px;
          cursor:pointer;
          flex-shrink:0;
        ">
  
        <img src="${safeImageURL(sp.image_url)}"
             style="width:100%;height:160px;object-fit:contain;border-radius:10px;">
  
        <div style="font-size:14px;font-weight:700;height:36px;overflow:hidden;margin:6px 0;">
          ${sp.name}
        </div>
  
        ${
          sp.discount_value > 0
          ? `<div style="font-size:12px;color:#999;text-decoration:line-through;">
               ${prices.before} Ø±.Ø³
             </div>`
          : ""
        }
  
        <div style="font-size:17px;font-weight:900;color:#8a004a;">
          ${prices.final} Ø±.Ø³
        </div>
      </div>
    `;
  });

  sliderHTML += `
      </div>

      <!-- Ø²Ø± â†’ -->
      <button id="simNext" 
        style="
          position:absolute;top:50%;left:-10px;transform:translateY(-50%);
          z-index:10;background:#8a004a;color:white;border:none;
          width:35px;height:35px;border-radius:50%;font-size:18px;cursor:pointer;">
        â€º
      </button>

    </div>
  `;

  document.getElementById("productDetailsBox").innerHTML += sliderHTML;

  /* ===== Ø³Ù„ÙˆÙƒ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ===== */
  const slider = document.getElementById("simSlider");
  const cardWidth = 200; // Ø¹Ø±Ø¶ ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø© + Ù…Ø³Ø§ÙØ©

  document.getElementById("simPrev").onclick = () => {
    slider.scrollBy({ left: -cardWidth, behavior: "smooth" });
  };

  document.getElementById("simNext").onclick = () => {
    slider.scrollBy({ left: cardWidth, behavior: "smooth" });
  };

  // Ø³Ù„Ø§ÙŠØ¯Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ
  slider.scrollTop = 0;
slider.scrollLeft = 0;
  
  setInterval(() => {
    slider.scrollBy({ left: cardWidth, behavior: "smooth" });
  }, 3000);

}


}



async function loadBrandsList(){
  const res = await fetch(API + "/api/admin/brands");
  const brands = await res.json();

  const grid = document.getElementById("brandsGrid");
  grid.innerHTML = "";

  brands.forEach(b=>{
    grid.innerHTML += `
      <div class="brand-box" onclick="go('brand', ${b.id})">
        <div class="brand-circle">
          <img src="${b.image_url || 'https://via.placeholder.com/100'}">
        </div>
        <div class="brand-name">${b.name}</div>
      </div>
    `;
  });
}

async function loadBrandProducts(brand_id){
  const res = await fetch(API + "/api/admin/products");
  const all = await res.json();

  const list = all.filter(p => p.brand_id == brand_id);

  const brand = list.length ? list[0].brand_name : "Ù…Ø§Ø±ÙƒØ©";
  document.getElementById("brandTitle").innerText = brand;

  const grid = document.getElementById("brandProductsGrid");
  grid.innerHTML = "";

  list.forEach(p=>{
    grid.innerHTML += makeProductCard(p);
  });

  // â­ Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§
  refreshAllAddToCartButtons();
}

function loadCheckout(){
  const box = document.getElementById("checkoutItems");
  box.innerHTML = "";

  let total = 0;

  cart.forEach(item=>{
    let t = item.qty * item.price;
    total += t;

    box.innerHTML += `
      <div style="padding:10px 0;border-bottom:1px solid #eee;">
        ${item.name}  
        <br>
        Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty} Ã— ${item.price} = ${t.toFixed(2)} Ø±.Ø³
      </div>
    `;
  });

  document.getElementById("checkoutTotal").innerText = total.toFixed(2);
}

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¨Ø§Ùƒ Ø§Ù†Ø¯
async function confirmOrder(){
  const name = checkoutName.value.trim();
  const phone = checkoutPhone.value.trim();

  if(!name || !phone){
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„");
    return;
  }

const body = {
    customer_name: window.user.name,
    customer_phone: window.user.phone,   // â­ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ â€” Ø§Ù„Ø±Ù‚Ù… ÙŠØ£ØªÙŠ Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·
    customer_phone2: phone,               // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ÙŠØ¯Ø®Ù„Ù‡ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙÙˆØ±Ù… (Ø±Ù‚Ù… Ø«Ø§Ù†ÙˆÙŠ)
    customer_address: document.getElementById("co_address").value.trim(),
    customer_location: document.getElementById("co_location").value.trim(),
    customer_notes: document.getElementById("co_notes").value.trim(),

    items: cart.map(item => ({
        id: item.id,
        name: item.name,
        qty: item.qty,
        base_price: item.base_price,
        discount_value: window.productsCache.find(p => p.id == item.id)?.discount_value || 0,
        discount_type: window.productsCache.find(p => p.id == item.id)?.discount_type || "none"
    }))
};




  const res = await fetch(API + "/api/orders", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(body)
  });

  const data = await res.json();

  if(data.success){
    cart = [];
    go("thanks", data.order_id);
  }
}


async function trackOrder(){
  const id = trackInput.value.trim();
  if(!id) return;

  const res = await fetch(API + "/api/orders/" + id);
  const data = await res.json();

  const box = document.getElementById("trackResult");

  if(data.error){
    box.innerHTML = "âŒ Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
    return;
  }

  box.innerHTML = `
    <p>Ø§Ù„Ø§Ø³Ù…: ${data.order.customer_name}</p>
    <p>Ø§Ù„Ù‡Ø§ØªÙ: ${data.order.customer_phone}</p>
    <p>Ø§Ù„Ø­Ø§Ù„Ø©: <b>${data.order.status}</b></p>
    <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.order.total} Ø±.Ø³</p>
  `;
}
async function doLogin(){
  let phone = loginPhone.value.trim();
  const pass = loginPass.value.trim();

  phone = phone.replace(/\s+/g, "");

  if (phone.startsWith("0")) phone = phone.substring(1);
  if (phone.startsWith("966")) phone = phone.substring(3);
  if (phone.startsWith("00966")) phone = phone.substring(5);

  const res = await fetch(API + "/api/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ phone, password: pass })
  });

  const data = await res.json();

  if (!data.success) {

    if (data.verify === true) {
        localStorage.setItem("pending_phone", phone);
        document.getElementById("vPhone").value = phone;
        go("verify");
        return;
    }
    loginMsg.innerText = "âŒ " + data.message;
    return;
  }

  window.user = data.user;
  localStorage.setItem("user", JSON.stringify(data.user));
  go("profile");
}


async function doRegister(){

  const name = regName.value.trim();
  const phone = regPhone.value.trim();
  const email = regEmail.value.trim();
  const pass = regPass.value.trim();
  const pass2 = regPass2.value.trim();
  const address = regAddress.value.trim();

  // Ø§Ù„ØªØ­Ù‚Ù‚
  if(!name || !phone || !email || !pass || !pass2 || !address){
    registerMsg.innerText = "âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    return;
  }

if (phone.startsWith("0")) phone = phone.substring(1);
if (phone.startsWith("966")) phone = phone.substring(3);
if (phone.startsWith("00966")) phone = phone.substring(5);

if(!phone.match(/^5\d{8}$/)){
  registerMsg.innerText = "âŒ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 5 ÙˆØ·ÙˆÙ„Ù‡ 9 Ø£Ø±Ù‚Ø§Ù…";
  return;
}


  if(pass !== pass2){
    registerMsg.innerText = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©";
    return;
  }

    const res = await fetch(API + "/api/register", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      name,
      phone,
      email,
      password: pass,
      address
    })
  });

  const data = await res.json();

  if(!data.success){
    registerMsg.innerText = "âŒ " + data.message;
    return;
  }

  registerMsg.innerHTML = "âœ” ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ â€” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„";

  // Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ Ù„ØµÙØ­Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
  document.getElementById("vPhone").value = phone;

  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª
  startVerifyTimer();

  // Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
  go("verify");
}


async function loadProfile() {

  if (!window.user) {
    go("login");
    return;
  }

  // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  document.getElementById("pName").innerText = window.user.name;
  document.getElementById("pPhone").innerText = "ğŸ“± " + window.user.phone;
  document.getElementById("pEmail").innerText = "ğŸ“§ " + (window.user.email || "â€”");
  document.getElementById("pAddress").innerText = "ğŸ“ " + (window.user.address || "â€”");

  // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  const orders = await fetchUserOrders(window.user.phone);

  let html = "";

  if (orders.length === 0) {
    html = `<p style="text-align:center;color:#777;margin-top:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>`;
  } else {
    orders.forEach(o => {
      
      let st = "";
      if (o.status === "new") st = "st-new";
      else if (o.status === "preparing") st = "st-preparing";
      else if (o.status === "completed") st = "st-completed";
      else if (o.status === "out") st = "st-out";
      else if (o.status === "cancelled") st = "st-cancelled";

      html += `
      <div class="order-box">
        <p><b>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</b> ${o.id}</p>
        <p><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${o.date}</p>
        <p><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b> ${safeNum(o.total_with_shipping || o.total)} Ø±.Ø³</p>
        <p><span class="status-badge ${st}">${o.status}</span></p>
        <button onclick="go('track', ${o.id})" 
                style="margin-top:10px;background:#7a004b;color:white;border:none;padding:7px 12px;border-radius:6px;cursor:pointer;">
          ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
        </button>
      </div>
      `;
    });
  }

  document.getElementById("profileOrders").innerHTML = html;
}


function safeNum(n){
  return (!n || isNaN(n)) ? "0.00" : Number(n).toFixed(2);
}



async function loadHome(){
// ÙˆØ¶Ø¹ Ø³ÙƒÙŠÙ„ÙŠØªÙˆÙ† Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
const featuredGrid = document.getElementById("featuredGrid");
const discountGrid = document.getElementById("discountGrid");

// Ø´ÙƒÙ„ ÙƒØ§Ø±Øª Ø³ÙƒÙŠÙ„ÙŠØªÙˆÙ† ÙˆØ§Ø­Ø¯
const skeletonCard = `
  <div style="
    background:#fff;
    border-radius:16px;
    padding:12px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
  ">
    <div style="
      width:100%;
      height:160px;
      background:#e4e4e4;
      border-radius:12px;
      animation:pulse 1.4s infinite;
    "></div>

    <div style="height:14px;background:#e4e4e4;border-radius:8px;margin-top:10px;width:80%;animation:pulse 1.4s infinite;"></div>
    <div style="height:14px;background:#e4e4e4;border-radius:8px;margin-top:8px;width:60%;animation:pulse 1.4s infinite;"></div>
  </div>
`;

// Ù†ÙƒØ±Ø± 6 Ù…Ø±Ø§Øª
featuredGrid.innerHTML = skeletonCard.repeat(6);
discountGrid.innerHTML = skeletonCard.repeat(6);

// Ø­Ø±ÙƒØ© Ø§Ù„Ø³ÙƒÙŠÙ„ÙŠØªÙˆÙ†
const style = document.createElement("style");
style.innerHTML = `
@keyframes pulse {
  0% { opacity:.6; }
  50% { opacity:1; }
  100% { opacity:.6; }
}
`;
document.head.appendChild(style);

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª
  const brandsRes = await fetch(API + "/api/admin/brands");
  const brands = await brandsRes.json();

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  const prodRes = await fetch(API + "/api/admin/products");
  const products = await prodRes.json();

  // ==================== Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© ====================
  const slider = document.getElementById("brandsSlider");
  slider.innerHTML = "";

  brands
    .filter(b => b.featured == 1)         // â­ ÙÙ‚Ø· Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©
    .forEach(b => {
      slider.innerHTML += `
        <div class="brand-box" onclick="go('brand', ${b.id})">
          <div class="brand-circle">
            <img src="${b.image_url || 'https://via.placeholder.com/120'}">
          </div>
          <div class="brand-name">${b.name}</div>
        </div>
      `;
    });

  // ==================== Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© ====================
  featuredGrid.innerHTML = "";

  products
    .filter(p => p.featured == 1)        // â­ ÙÙ‚Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©
    .slice(0, 12)
    .forEach(p => {
      featuredGrid.innerHTML += makeProductCard(p);
    });

  // ==================== Ø§Ù„Ø¹Ø±ÙˆØ¶ (Ø®ØµÙˆÙ…Ø§Øª) ====================
  
  discountGrid.innerHTML = "";

  products
    .filter(p => p.discount_value > 0)
    .slice(0, 12)
    .forEach(p => {
      discountGrid.innerHTML += makeProductCard(p);
    });
	
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙØ­Ø©
  refreshAllAddToCartButtons();
}
function makeProductCard(p){
  const isFav = wishlist.includes(p.id);

  return `
    <div class="product-card" style="position:relative;" onclick="go('product', ${p.id})">

      <!-- Ø²Ø± Ø§Ù„Ù‚Ù„Ø¨ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø±Øª -->
      <div onclick="event.stopPropagation(); toggleWishlist(${p.id});"
           style="
             position:absolute;
             top:10px;
             left:10px;
             font-size:20px;
             cursor:pointer;
             z-index:20;
             color:${isFav ? '#E91E63' : '#bbb'};
           ">
        â¤
      </div>

      <!-- Ø§Ù„ØµÙˆØ±Ø© + Ø§Ù„Ø®ØµÙ… -->
      <div style="position:relative;">

        <!-- Ø§Ù„Ø®ØµÙ… ÙÙŠ Ø£Ø³ÙÙ„ ÙŠÙ…ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© -->
        ${
          p.discount_value > 0
          ? `<div style="
                position:absolute;
                bottom:0px;
                right:2px;
                background:#00a6ff;
                color:white;
                padding:3px 10px;
                font-size:12px;
                border-radius:20px;
                font-weight:600;
                white-space:nowrap;
                z-index:10;
              ">
              Ø®ØµÙ… ${p.discount_value}${p.discount_type === 'percent' ? "%" : ""}
             </div>`
          : ``
        }

        <!-- Ø§Ù„ØµÙˆØ±Ø© -->
        <img class="product-img"
     src="${safeImageURL(p.image_url)}"
     onerror="this.src='https://via.placeholder.com/200?text=No+Image'"
     onclick="go('product', ${p.id})"
     style="filter:${p.stock_qty > 0 ? 'none' : 'grayscale(100%) opacity(40%)'};" />
      </div>

      <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ -->
      <h3 class="product-name"
          style="font-size:12px; line-height:1.35; height:40px; overflow:hidden; margin:6px 0;"
          onclick="go('product', ${p.id})">
        ${p.name}
      </h3>

      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
      <div class="price-row"
           style="display:flex;align-items:center;gap:10px;margin-top:6px;flex-direction:row-reverse;">

        <!-- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± -->
${(() => {
  const prices = calculateFinalPrice(p);

  return `
    <div style="display:flex;align-items:center;gap:8px;flex-direction:row-reverse;">

      <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
      <div style="
        font-size:17px;
        font-weight:bold;
        color:${p.discount_value > 0 ? 'red' : '#006b6a'};
        white-space:nowrap;">
        ${prices.final} Ø±.Ø³
      </div>

      <!-- Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ… -->
      ${
        p.discount_value > 0 
        ? `<div style="
              font-size:13px;
              color:#999;
              text-decoration:line-through;
              white-space:nowrap;
            ">
              ${prices.before} Ø±.Ø³
           </div>`
        : ``
      }

    </div>
  `;
})()}


      </div>

      <!-- Ø²Ø± Ø§Ù„Ø³Ù„Ø© -->
      <!-- Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
${
  p.stock_qty > 0
  ? `
      <button 
        id="cart-btn-${p.id}"
        onclick="event.stopPropagation(); addToCart(${p.id})"
        class="add-cart">
        Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
      </button>
    `
  : `
      <button 
        disabled
        class="add-cart"
        style="background:#999;cursor:not-allowed;">
        Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù†ØªÙ‡ÙŠØ©
      </button>
    `
}


    </div>
  `;
}


// ========================== Ø§Ù„Ø³Ù„Ø© ==========================

let cart = JSON.parse(localStorage.getItem("cart") || "[]");

function saveCart(){
  localStorage.setItem("cart", JSON.stringify(cart));
}

function openCart(){
  document.getElementById("cartOverlay").style.display = "block";
  document.getElementById("cartPanel").style.right = "0px";
  renderCart();
}

function closeCart(){
  document.getElementById("cartOverlay").style.display = "none";
  document.getElementById("cartPanel").style.right = "-350px";
}

async function addToCart(id){

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† API Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
  if(!window.productsCache){
    const res = await fetch(API + "/api/admin/products");
    window.productsCache = await res.json();
  }

  const p = window.productsCache.find(x => x.id == id);
  if(!p) return;

  // Ù‡Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯
  let item = cart.find(x => x.id == id);
  if(item){
    const p = window.productsCache.find(x => x.id == id);

if (item.qty + 1 > p.stock_qty) {
    alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (" + p.stock_qty + ")");
    return;
}

item.qty++;

  } else {
    // Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
let base = parseFloat(p.base_price) || 0;
let discountValue = parseFloat(p.discount_value) || 0;
let discountType = p.discount_type;

let priceAfterDiscount = base;

if (discountValue > 0) {
    if (discountType === "percent") {
        priceAfterDiscount = base - (base * (discountValue / 100));
    } else if (discountType === "fixed") {
        priceAfterDiscount = base - discountValue;
    }
}

let priceWithVat = priceAfterDiscount * 1.15;

item = {
    id: p.id,
    name: p.name,
    qty: 1,
	max_qty: p.stock_qty,
    image: p.image_url,

    // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ â€” ÙŠÙØ±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ù„Ù‰ orders.html
    base_price: base,
    price_after_discount: priceAfterDiscount.toFixed(2),
    price_with_vat: priceWithVat.toFixed(2),
    total: priceWithVat.toFixed(2)   // Ù„Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
};

    cart.push(item);
  }

  saveCart();
  renderCart();
  updateCartIcon();
  refreshCurrentPage();


  // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ÙƒØ±Øª Ù„Ù„Ù…Ù†ØªØ¬
  const btn = document.getElementById(`cart-btn-${id}`);
  if(btn){
    btn.innerText = `Ù…Ø¶Ø§Ù Ù„Ù„Ø³Ù„Ø© +${item.qty}`;
    btn.style.background = "#8a004a";
    btn.style.color = "#fff";
    btn.classList.add("added");
  }

  // ØªØ­Ø¯ÙŠØ« Ø²Ø± ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬
  updateProductPageButton(id);
}



function removeItem(id){
  cart = cart.filter(x => x.id != id);

  saveCart();
  renderCart();          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
  renderCheckoutPage();  // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
  updateCartIcon();
  refreshAllAddToCartButtons();
  updateProductPageButton(id);
}





function changeQty(id, q){
  const item = cart.find(x => x.id == id);
  if(!item) return;
if(q > 0 && item.qty + 1 > item.max_qty){
    alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªÙˆÙØ± (" + item.max_qty + ")");
    return;
}
  item.qty += q;

  if(item.qty <= 0){
    removeItem(id);
  } else {
    saveCart();
    renderCart();
    renderCheckoutPage();  // â† ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
  }

  updateCartIcon();
  refreshAllAddToCartButtons();
  updateProductPageButton(id);
}



function renderCart() {
  const box = document.getElementById("cartItems");
  const totalBox = document.getElementById("cartTotal");

  box.innerHTML = "";
  let total = 0;

  cart.forEach(item => {

// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠØ©
let p = window.productsCache?.find(x => x.id == item.id);

let base = parseFloat(p.base_price) || 0;
let discountValue = parseFloat(p.discount_value) || 0;
let discountType = p.discount_type;

// Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ø¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
let beforePrice = base * 1.15;

// Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
let priceAfterDiscount = base;

if (discountValue > 0) {
  if (discountType === "percent") {
    priceAfterDiscount = base - (base * (discountValue / 100));
  } else if (discountType === "fixed") {
    priceAfterDiscount = base - discountValue;
  }
}

// Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
let finalPrice = priceAfterDiscount * 1.15;

// Ù…Ø¬Ù…ÙˆØ¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬
let lineTotal = finalPrice * item.qty;
total += lineTotal;


    box.innerHTML += `
      <div style="display:flex; align-items:flex-start; gap:10px; margin-bottom:15px;">

        <img src="${safeImageURL(item.image)}"
             onerror="this.src='https://via.placeholder.com/80?text=No+Img'"
             style="width:60px; height:60px; object-fit:cover; border-radius:10px;">

        <div style="flex:1; display:flex; flex-direction:column;">

          <div style="font-weight:600; color:#333; margin-bottom:4px; line-height:1.4; font-size:14px;">
            ${item.name}
          </div>

          <div style="margin-bottom:5px;">

            ${
  discountValue > 0
  ? `
      <!-- Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ… -->
      <div style="
        font-size:12px;
        color:#999;
        text-decoration:line-through;
        white-space:nowrap;
      ">
        ${beforePrice.toFixed(2)} Ø±.Ø³
      </div>

      <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
      <div style="
        font-size:17px;
        font-weight:bold;
        color:red;
        white-space:nowrap;
      ">
        ${finalPrice.toFixed(2)} Ø±.Ø³
      </div>
    `
  : `
      <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø®ØµÙ… -->
      <div style="
        font-size:17px;
        font-weight:bold;
        color:#006b6a;
        white-space:nowrap;
      ">
        ${beforePrice.toFixed(2)} Ø±.Ø³
      </div>
    `
}


          </div>

          <div style="display:flex; align-items:center; gap:6px;">

            <button onclick="changeQty(${item.id}, -1)"
              style="background:#eee; border:none; border-radius:6px;
                     padding:2px 8px; font-size:14px; cursor:pointer;">-</button>

            <span style="font-size:15px; font-weight:bold; min-width:18px; text-align:center;">
              ${item.qty}
            </span>

            <button onclick="changeQty(${item.id}, +1)"
              style="background:#eee; border:none; border-radius:6px;
                     padding:2px 8px; font-size:14px; cursor:pointer;">+</button>

            <button onclick="removeItem(${item.id})"
              style="background:#ffe6f0; border:none; border-radius:6px;
                     padding:3px 10px; font-size:13px; color:#8a004a; cursor:pointer;">Ø­Ø°Ù</button>

          </div>

        </div>
      </div>
    `;
  });

  totalBox.innerText = total.toFixed(2);
}

// ========== ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ù„Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ==========
function refreshAllAddToCartButtons() {
  document.querySelectorAll("[id^='cart-btn-']").forEach(btn => {

    const id = Number(btn.id.replace("cart-btn-", ""));
    const item = cart.find(x => x.id === id);

    if (item) {
      // Ø¥Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³Ù„Ø©
      btn.innerText = `Ù…Ø¶Ø§Ù Ù„Ù„Ø³Ù„Ø© +${item.qty}`;
      btn.style.background = "#8a004a";
      btn.style.color = "#fff";
      btn.classList.add("added");
    } else {
      // Ø¥Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø£Ø±Ø¬Ø¹ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
      btn.innerText = "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©";
      btn.style.background = "";
      btn.style.color = "";
      btn.classList.remove("added");
    }
  });

  // Ù†ÙØ³ Ø§Ù„Ø´ÙŠØ¡ Ù„Ø²Ø± ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬
  const productBtn = document.getElementById("productAddBtn");
  if (productBtn) {
    const productId = Number(productBtn.getAttribute("data-id"));
    const item = cart.find(x => x.id === productId);

    if (item) {
      productBtn.innerText = `Ù…Ø¶Ø§Ù Ù„Ù„Ø³Ù„Ø© +${item.qty}`;
      productBtn.style.background = "#8a004a";
      productBtn.style.color = "#fff";
      productBtn.classList.add("added");
    } else {
      productBtn.innerText = "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©";
      productBtn.style.background = "";
      productBtn.style.color = "";
      productBtn.classList.remove("added");
    }
  }
}



// ========== ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬ ==========
function updateProductPageButton(id){
  const btn = document.getElementById("productAddBtn");
  if(!btn) return;

  const item = cart.find(x => x.id == id);

  if(item){
    btn.innerText = `Ù…Ø¶Ø§Ù Ù„Ù„Ø³Ù„Ø© +${item.qty}`;
    btn.classList.add("added");
  }
  else {
    btn.innerText = "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©";
    btn.classList.remove("added");
  }
}







// ========== ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± ==========
function updateCartIcon(){
  const count = cart.reduce((sum, item) => sum + item.qty, 0);
  const badge = document.getElementById("cartCount");

  if(!badge) return;

  if(count > 0){
    badge.style.display = "inline-block";
    badge.innerText = count;
  } else {
    badge.style.display = "none";
  }
}

function goToCheckout() {

  if (cart.length === 0) {
    alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€” Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
    return;
  }

  closeCart();
  go("checkout");
}

function scrollBrands(px){
  document.getElementById("brandsSlider").scrollBy({
    left: px,
    behavior: "smooth"
  });
}
async function loadOffers(){
  const res = await fetch(API + "/api/admin/products");
  const products = await res.json();

  const offers = products.filter(p => p.discount_value > 0);

  const grid = document.getElementById("offersGrid");
  grid.innerHTML = "";

  offers.forEach(p=>{
    grid.innerHTML += makeProductCard(p);
  });

  // â­ Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§
  refreshAllAddToCartButtons();
}

async function loadCategories(){
  const res = await fetch(API + "/api/admin/products");
  const products = await res.json();

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
  let cats = {};

  products.forEach(p=>{
    if(p.category){
      cats[p.category] = true;
    }
  });

  const list = Object.keys(cats);

  const box = document.getElementById("categoriesList");
  box.innerHTML = "";

  if(list.length === 0){
    box.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª</p>";
    return;
  }

  list.forEach(cat=>{
    box.innerHTML += `
      <div onclick="go('category', '${cat}')" 
           style="background:#f9d9e6;padding:20px;border-radius:14px;text-align:center;font-size:16px;color:#8a004a;font-weight:600;cursor:pointer;">
        ${cat}
      </div>
    `;
  });

}
async function loadCategoryProducts(catName){
  const res = await fetch(API + "/api/admin/products");
  const products = await res.json();

  const filtered = products.filter(p => p.category === catName);

  document.getElementById("categoryTitle").innerText = "ØªØµÙ†ÙŠÙ: " + catName;

  const grid = document.getElementById("categoryGrid");
  grid.innerHTML = "";

  filtered.forEach(p=>{
    grid.innerHTML += makeProductCard(p);
  });

  // â­ Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§
  refreshAllAddToCartButtons();
}



let headerProductsCache = [];

async function headerLiveSearch(){
  const box = document.getElementById("headerSearchResults");
  const text = document.getElementById("headerSearch").value.toLowerCase();

  if(text.trim() === ""){
    box.style.display = "none";
    box.innerHTML = "";
    return;
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
  if(headerProductsCache.length === 0){
    const res = await fetch(API + "/api/admin/products");
    headerProductsCache = await res.json();
  }

  const results = headerProductsCache.filter(p =>
    p.name.toLowerCase().includes(text)
  );

  if(results.length === 0){
    box.style.display = "block";
    box.innerHTML = `
      <div style="padding:10px;text-align:center;color:#888;">
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬
      </div>
    `;
    return;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  box.style.display = "block";
  box.innerHTML = "";

  results.slice(0, 10).forEach(p=>{
    box.innerHTML += `
      <div onclick="go('product', ${p.id}); clearHeaderSearch();"
           style="padding:10px;display:flex;gap:10px;cursor:pointer;border-bottom:1px solid #f5f5f5;">
        <img src="${p.image_url}" style="width:45px;height:45px;border-radius:8px;object-fit:cover;">
        <div style="font-size:14px;color:#333;">
          ${p.name}
          <div style="color:#E91E63;font-weight:bold;">${p.base_price} Ø±.Ø³</div>
        </div>
      </div>
    `;
  });
}

function clearHeaderSearch(){
  document.getElementById("headerSearch").value = "";
  document.getElementById("headerSearchResults").style.display = "none";
}
document.addEventListener("click", function(e){
  const box = document.getElementById("headerSearchResults");
  const search = document.getElementById("headerSearch");

  if(!search.contains(e.target) && !box.contains(e.target)){
    box.style.display = "none";
  }
});
// ======================== Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø§Øª ========================
let wishlist = JSON.parse(localStorage.getItem("wishlist") || "[]"); // IDs ÙÙ‚Ø·


function saveWishlist(){
  localStorage.setItem("wishlist", JSON.stringify(wishlist));
}

async function toggleWishlist(id){

  // Ù„Ùˆ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø§Ø­Ø°ÙÙ‡
  if(wishlist.includes(id)){
    wishlist = wishlist.filter(x => x !== id);
  } 
  else {
    wishlist.push(id);
  }

  saveWishlist();
  refreshCurrentPage();
}


function refreshCurrentPage(){
  const active = document.querySelector(".page.active").id;

  if(active === "page-products") loadAllProducts();
  if(active === "page-home") loadHome();
  if(active === "page-wishlist") loadWishlist();
  if(active === "page-brand") loadBrandProducts(window.currentBrand);
  if(active === "page-category") loadCategoryProducts(window.currentCategory);
}
function getSARIcon(){
  return `
    <svg width="18" height="18" viewBox="0 0 1228 1228" style="vertical-align:middle;">
    <path d="M699.62 1113.02c-20.06 44.48-33.32 92.75-38.4 143.37l424.51-90.24c20.06-44.47 33.31-92.75 38.4-143.37zM1085.73 895.8c20.06-44.47 33.32-92.75 38.4-143.37l-330.68 70.33v-135.2l292.27-62.11c20.06-44.47 33.32-92.75 38.4-143.37l-330.68 70.27V66.13c-50.67 28.45-95.67 66.32-132.25 110.99v403.35l-132.25 28.11V0c-50.67 28.44-95.67 66.32-132.25 110.99v525.69l-295.91 62.88c-20.06 44.47-33.33 92.75-38.42 143.37l334.33-71.05v170.26l-358.3 76.14c-20.06 44.47-33.32 92.75-38.4 143.37l375.04-79.7c30.53-6.35 56.77-24.4 73.83-49.24l68.78-101.97v-.02c7.14-10.55 11.3-23.27 11.3-36.97V743.77l132.25-28.11v270.4l424.53-90.28Z" fill="#8a004a"></path>
    </svg>
  `;
}

function renderCheckoutPage() {
  const box = document.getElementById("checkoutItems");
  box.innerHTML = "";

  let subtotal = 0;
  let totalQty = 0;

  cart.forEach(item => {

    // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    let p = window.productsCache?.find(x => x.id == item.id);

    let base = parseFloat(p.base_price) || 0;
    let discountValue = p?.discount_value || 0;
    let discountType = p?.discount_type || "none";

    // Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
    let priceAfterDiscount = base;

    if (discountValue > 0) {
      if (discountType === "percent") priceAfterDiscount = base - (base * discountValue / 100);
      else if (discountType === "fixed") priceAfterDiscount = base - discountValue;
    }

    // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ø¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
    let finalPrice = priceAfterDiscount * 1.15;

    let lineTotal = finalPrice * item.qty;
    subtotal += lineTotal;
    totalQty += item.qty;

    box.innerHTML += `
      <div style="border-bottom:1px solid #eee;padding-bottom:15px;margin-bottom:15px;">

        <div style="display:flex;justify-content:space-between;align-items:flex-start;">
          
          <div style="flex:1;text-align:right;">
            <div style="font-weight:700;margin-bottom:5px;">${item.name}</div>

            <div style="margin-bottom:5px;font-weight:700;">
              ${
                discountValue > 0
                ? `
                    <span style="text-decoration:line-through;color:#999;font-size:14px;margin-left:8px;">
                      ${(base * 1.15).toFixed(2)} Ø±.Ø³
                    </span>

                    <span style="color:#8a004a;font-weight:700;">
                      ${finalPrice.toFixed(2)} Ø±.Ø³
                    </span>
                  `
                : `
                  <span style="color:#8a004a;font-weight:700;">
                    ${(base * 1.15).toFixed(2)} Ø±.Ø³
                  </span>
                `
              }
            </div>

            <div style="display:flex;align-items:center;gap:10px;justify-content:flex-end;">
              <button onclick="changeQtyCheckout(${item.id}, -1)" class="qty-btn">-</button>
              <span style="font-size:16px;font-weight:bold;">${item.qty}</span>
              <button onclick="changeQtyCheckout(${item.id}, +1)" class="qty-btn">+</button>
            </div>
          </div>

          <img src="${safeImageURL(item.image)}"
               style="width:70px;height:70px;border-radius:10px;object-fit:cover;margin-left:10px;">
        </div>

        <button onclick="removeItemCheckout(${item.id})"
          style="background:#ffd6e3;color:#E91E63;border:none;padding:5px 15px;border-radius:6px;font-size:14px;margin-top:10px;">
          Ø­Ø°Ù
        </button>

      </div>
    `;
  });

  // Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
// ===== ØªÙØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù†Ù‡Ø¯ÙŠ =====
// ===== Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© =====
let base_before_vat_total = 0;
let discount_amount_total = 0;
let subtotal_before_vat = 0;
let subtotal_with_vat = 0;
let vat_total = 0;

cart.forEach(item => {
    let p = window.productsCache.find(x => x.id == item.id);

    let base = parseFloat(p.base_price) || 0;
    let discountValue = p.discount_value || 0;
    let discountAmount = 0;

    // Ø§Ù„Ø®ØµÙ… Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
    if (p.discount_type === "percent") {
        discountAmount = base * (discountValue / 100);
    } 
    else if (p.discount_type === "fixed") {
        discountAmount = discountValue;
    }

    let price_after_discount = base - discountAmount;
    let final_price = price_after_discount * 1.15;

    base_before_vat_total += base * item.qty;
    discount_amount_total += discountAmount * item.qty;
    subtotal_before_vat += price_after_discount * item.qty;
    subtotal_with_vat += final_price * item.qty;
});

// Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
vat_total = subtotal_with_vat - subtotal_before_vat;

// ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
let coupon_discount = 0;

// Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
let total_final = subtotal_with_vat - coupon_discount;

// --- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø­Ù† ---
let shipping = 15;
let shippingVat = shipping * 0.15;
let finalTotalWithShipping = subtotal_with_vat + shipping + shippingVat;

// ===== Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© =====
box.innerHTML += `

  <div style="padding:12px;margin-top:15px;line-height:1.9;font-size:15px;">

    <div style="display:flex;justify-content:space-between;">
      <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¨Ø¯ÙˆÙ† Ø¶Ø±ÙŠØ¨Ø©)</span>
      <b>${base_before_vat_total.toFixed(2)} Ø±.Ø³</b>
    </div>

    <div style="display:flex;justify-content:space-between; color:green;">
      <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµÙˆÙ…</span>
      <b>- ${discount_amount_total.toFixed(2)} Ø±.Ø³</b>
    </div>

    <hr style="margin:12px 0;">

    <div style="display:flex;justify-content:space-between;">
      <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ (Ø¨Ø¯ÙˆÙ† Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©)</span>
      <b>${subtotal_before_vat.toFixed(2)} Ø±.Ø³</b>
    </div>

    <div style="display:flex;justify-content:space-between;">
      <span>Ù‚ÙŠÙ…Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©</span>
      <b>${vat_total.toFixed(2)} Ø±.Ø³</b>
    </div>

    <hr style="margin:12px 0;">

    <div style="display:flex;justify-content:space-between;">
      <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ (Ø´Ø§Ù…Ù„ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©)</span>
      <b>${subtotal_with_vat.toFixed(2)} Ø±.Ø³</b>
    </div>

    <div style="display:flex;justify-content:space-between;">
      <span>Ø§Ù„Ø®ØµÙ… (ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…)</span>
      <b>${coupon_discount.toFixed(2)} Ø±.Ø³</b>
    </div>

    <div style="margin-top:15px;font-size:22px;font-weight:800;color:#E91E63;text-align:center;">
      Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total_final.toFixed(2)} Ø±.Ø³
    </div>

  </div>
  <div style="display:flex;justify-content:space-between;">
  <span>Ø§Ù„Ø´Ø­Ù†:</span>
  <b>${shipping.toFixed(2)} Ø±.Ø³</b>
</div>

<div style="display:flex;justify-content:space-between;">
  <span>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø´Ø­Ù† (15%):</span>
  <b>${shippingVat.toFixed(2)} Ø±.Ø³</b>
</div>

<hr style="margin:12px 0;">

<div style="display:flex;justify-content:space-between;font-size:20px;color:#8a004a;font-weight:900;">
  <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ + Ø§Ù„Ø´Ø­Ù†:</span>
  <b>${finalTotalWithShipping.toFixed(2)} Ø±.Ø³</b>
</div>

`;
}




async function payOnline() {
// ğŸ” Ù…Ù†Ø¹ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
if (!window.user) {
  alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
  go("login");
  return;
}


  if (cart.length === 0) {
    alert("âš ï¸ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
    return;
  }

  // 1) Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  const name = document.getElementById("co_name").value.trim();
  const phone = document.getElementById("co_phone").value.trim();
  const phone2 = document.getElementById("co_phone2").value.trim();
  const notes = document.getElementById("co_notes").value.trim();
  const address = document.getElementById("co_address").value.trim();
  const location = document.getElementById("co_location").value.trim();

  if (!name || !phone) {
    alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
    return;
  }

  // 2) ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¨Ø§Ùƒ Ø§Ù†Ø¯
  const body = {
    customer_name: name,
    customer_phone: phone,
	shipping: 15,
    shipping_vat: 15 * 0.15,
	customer_phone2: phone2,
	customer_notes: notes,
    customer_address: address,
    customer_location: location,
    notes: notes,

    items: cart.map(item => ({
    id: item.id,
    name: item.name,
    qty: item.qty,
    base_price: item.base_price,
    discount_value: window.productsCache.find(p => p.id == item.id)?.discount_value || 0,
    discount_type: window.productsCache.find(p => p.id == item.id)?.discount_type || "none"
}))


  };

  // 3) Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
  
  const res = await fetch(API + "/api/orders", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  });

  const data = await res.json();

  if (!data.success) {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
    return;
  }

const orderId = data.order_id;

// ===== Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ localStorage Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… =====
let dashboardOrders = JSON.parse(localStorage.getItem("orders") || "[]");

dashboardOrders.push({
    id: orderId,
    date: new Date().toLocaleString("ar-EG"),
    customer_name: name,
    customer_phone: phone,
    items: cart.map(item => ({
        id: item.id,
        name: item.name,
        qty: item.qty,
        base_price: item.base_price,
        price_after_discount: item.price_after_discount,
        price_with_vat: item.price_with_vat,
        total: (item.price_with_vat * item.qty).toFixed(2)
    })),
    total: cart.reduce((sum, i) => sum + (i.price_with_vat * i.qty), 0).toFixed(2),
    status: "new"
});


localStorage.setItem("orders", JSON.stringify(dashboardOrders));
// ====================================================


  // 4) ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© + ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  cart = [];
  saveCart();
  updateCartIcon();

  // 5) Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ + ØµÙØ­Ø© Ø§Ù„Ø´ÙƒØ±
  go("thanks", orderId);
}


function changeQtyCheckout(id, amount){
  let item = cart.find(p => p.id == id);
  if(!item) return;
	let p = window.productsCache.find(x => x.id == item.id);
if(amount > 0 && item.qty + 1 > p.stock_qty){
    alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªÙˆÙØ± (" + p.stock_qty + ")");
    return;
}

  item.qty += amount;
  if(item.qty <= 0){
    cart = cart.filter(p => p.id != id);
  }

  saveCart();
  renderCheckoutPage();
  updateCartIcon();          // â† ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
  refreshAllAddToCartButtons(); // â† ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
}


function removeItemCheckout(id){
  cart = cart.filter(p => p.id != id);

  saveCart();
  renderCheckoutPage();
  updateCartIcon();             // â† ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
  refreshAllAddToCartButtons(); // â† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
}


function pickLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    let link = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    document.getElementById("co_location").value = link;
  });
}


async function loadWishlist(){
  const res = await fetch(API + "/api/admin/products");
  const all = await res.json();

  const favList = all.filter(p => wishlist.includes(p.id));

  const grid = document.getElementById("wishlistGrid");
  grid.innerHTML = "";

  if(favList.length === 0){
    grid.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø©.</p>";
    return;
  }

  favList.forEach(p=>{
  grid.innerHTML += makeProductCard(p);
});

refreshAllAddToCartButtons();

}
async function loadTrackPage(orderId) {

  const infoBox = document.getElementById("trackInfo");
  const timelineBox = document.getElementById("timeline");
  const itemsBox = document.getElementById("trackItems");

  infoBox.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  timelineBox.innerHTML = "";
  itemsBox.innerHTML = "";

  const res = await fetch(`${API}/api/orders/${orderId}`);
  const data = await res.json();

  if (data.error) {
    infoBox.innerHTML = `<p style="color:red;">Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>`;
    return;
  }

  const o = data.order;

  /* ================================
     ğŸ›  Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù‚ÙŠÙ… Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§
     ================================ */
  o.total = Number(o.total) || 0;
  o.shipping = Number(o.shipping) || 0;
  o.shipping_vat = Number(o.shipping_vat) || 0;
  o.total_with_shipping = Number(o.total_with_shipping) || (o.total + o.shipping + o.shipping_vat);

  if (o.status === "delivery") o.status = "delivery";

  const items = data.items || [];

  // ---- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ----
  infoBox.innerHTML = `
    <p><b>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</b> ${o.id}</p>
    <p><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${o.date}</p>
    <p><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b> ${o.total_with_shipping.toFixed(2)} Ø±.Ø³</p>
  `;

  // ---- Ø§Ù„Ø­Ø§Ù„Ø§Øª ----
  const steps = [
    { key:"new", text:"ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨" },
    { key:"processing", text:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²" }, 
    { key:"completed", text:"Ø¬Ø§Ù‡Ø²" },
    { key:"out", text:"Ø®Ø±Ø¬ Ù„Ù„ØªÙˆØµÙŠÙ„" },
    { key:"delivery", text:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„" },
    { key:"done", text:"ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" }, 
    { key:"cancelled", text:"ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡" }
  ];

  let activeFound = true;

  steps.forEach(s => {
    let active = "";
    if (activeFound) active = "step-active";
    if (o.status === s.key) activeFound = false;

    timelineBox.innerHTML += `
      <div class="step-item ${active}">
        <div class="step-circle"></div>
        <div class="step-text">${s.text}</div>
      </div>
    `;
  });

  // ---- Ø§Ù„Ø£ØµÙ†Ø§Ù ----
  items.forEach(i => {

    const lineTotal = Number(i.total) || 0;

    itemsBox.innerHTML += `
      <div class="item-card">
        <b>${i.name}</b> Ã— ${i.qty}<br>
        Ø§Ù„Ø³Ø¹Ø±: ${lineTotal.toFixed(2)} Ø±.Ø³
      </div>
    `;
  });
}




async function viewOrder(id){
  const res = await fetch(API + "/api/orders/" + id);
  const data = await res.json();

  if(data.error){
    alert("Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    return;
  }

  let text = `
    Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${data.order.id}\n
    Ø§Ù„ØªØ§Ø±ÙŠØ®: ${data.order.date}\n
    Ø§Ù„Ø­Ø§Ù„Ø©: ${data.order.status}\n
    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.order.total} Ø±.Ø³\n\n
    --- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---\n
  `;

  data.items.forEach(i=>{
    text += `${i.name} Ã— ${i.qty}\n`;
  });

  alert(text);
}


async function fetchUserOrders(phone){
  const res = await fetch(API + "/api/orders?phone=" + phone);
  return await res.json();
}

function autoFillUserInCheckout() {
    if (window.user) {
        document.getElementById("co_name").value = window.user.name;
        document.getElementById("co_phone").value = window.user.phone;

        document.getElementById("co_name").setAttribute("readonly", true);
        document.getElementById("co_phone").setAttribute("readonly", true);
    }
}



// Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©


async function loadInvoice(orderId){

  const invoiceBox = document.getElementById("invoiceBox");
  invoiceBox.innerHTML = "<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>";

  // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
  const orderRes = await fetch(`${API}/api/orders/${orderId}`);
  const orderData = await orderRes.json();

  if(orderData.error){
    invoiceBox.innerHTML = "<p style='color:red;text-align:center;'>Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>";
    return;
  }

  const o = orderData.order;

  // Ø¬Ù„Ø¨ Ø§Ù„Ø£ØµÙ†Ø§Ù ÙƒØ§Ù…Ù„Ø© (Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± + Ø§Ù„ØµÙˆØ± + Ø§Ù„Ø£ÙƒÙˆØ§Ø¯)
  const itemsRes = await fetch(`${API}/api/order_items_full/${orderId}`);
  const items = await itemsRes.json();

  let itemsHTML = "";
  let total = 0;

  items.forEach(i => {

    total += i.total;

    itemsHTML += `
      <tr>
        <td style="border:1px solid #ccc;padding:8px;">${i.name}</td>
        <td style="border:1px solid #ccc;padding:8px;text-align:center;">${i.qty}</td>
        <td style="border:1px solid #ccc;padding:8px;text-align:center;">${i.base_price.toFixed(2)}</td>
        <td style="border:1px solid #ccc;padding:8px;text-align:center;">${i.price_after_discount.toFixed(2)}</td>
        <td style="border:1px solid #ccc;padding:8px;text-align:center;">${i.price_with_vat.toFixed(2)}</td>
        <td style="border:1px solid #ccc;padding:8px;text-align:center;">${i.total.toFixed(2)}</td>
      </tr>
    `;
  });

  const html = `
    <h3 style="color:#8a004a;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>

    <p><b>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</b> ${o.id}</p>
    <p><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${o.date}</p>
    <p><b>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${o.customer_name}</p>
    <p><b>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</b> ${o.customer_phone}</p>
    <p><b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> ${o.customer_address}</p>

    <table style="width:100%;border-collapse:collapse;margin-top:20px;">
      <thead>
        <tr style="background:#f9d9e6;color:#7a004b;">
          <th style="padding:8px;border:1px solid #ccc;">Ø§Ù„ØµÙ†Ù</th>
          <th style="padding:8px;border:1px solid #ccc;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th style="padding:8px;border:1px solid #ccc;">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
          <th style="padding:8px;border:1px solid #ccc;">Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…</th>
          <th style="padding:8px;border:1px solid #ccc;">Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
          <th style="padding:8px;border:1px solid #ccc;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        </tr>
      </thead>
      <tbody>
        ${itemsHTML}
      </tbody>
    </table>
<h4 style="margin-top:15px;">
  Ø§Ù„Ø´Ø­Ù†: ${o.shipping.toFixed(2)} Ø±.Ø³
</h4>

<h4>
  Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø´Ø­Ù† (15%): ${o.shipping_vat.toFixed(2)} Ø±.Ø³
</h4>

<h2 style="color:#8a004a;margin-top:15px;font-weight:900;text-align:right;">
  Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ø¹ Ø§Ù„Ø´Ø­Ù†:
  ${o.total_with_shipping.toFixed(2)} Ø±.Ø³
</h2>

  `;

  invoiceBox.innerHTML = html;
}


function logoutUser() {
  // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
  localStorage.removeItem("user");
  window.user = null;

  alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");

  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  go("login");
}

  // ====================== Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ù†Ø³ÙŠØ§Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ======================
async function sendResetCode() {
  const email = fpEmail.value.trim();

  const res = await fetch(API + "/api/forgot", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });

  const data = await res.json();

  if (!data.success) {
    fpMsg.innerText = "âŒ " + data.message;
    return;
  }

  alert("âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
  rpEmail.value = email;
  go("reset");
}
// ====================== Ø´ÙƒÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ ======================
function openMenu() {
  document.getElementById("sideMenu").style.right = "0px";
  document.getElementById("menuOverlay").style.display = "block";
}

function closeMenu() {
  document.getElementById("sideMenu").style.right = "-260px";
  document.getElementById("menuOverlay").style.display = "none";
}

// ====================== Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ======================
async function resetPassword() {
  const email = rpEmail.value.trim();
  const code = rpCode.value.trim();
  const new_password = rpPass.value.trim();

  const res = await fetch(API + "/api/reset-password", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, code, new_password })
  });

  const data = await res.json();

  if (!data.success) {
    rpMsg.innerText = "âŒ " + data.message;
    return;
  }

  alert("âœ” ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
  go("login");
}
// ====================== ØªÙØ¹ÙŠÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹  ======================
function isLoggedIn() {
    let user = localStorage.getItem("user");
    return user && user !== "null" && user !== "";
}
function checkBeforeCheckout() {

    if (!isLoggedIn()) {
        showLoginRequiredPopup();
        return;
    }

    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ â†’ Ø§Ø°Ù‡Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
    go("checkout");
}	
// ====================== ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ======================
async function verifyAccount(){
  const phone = document.getElementById("vPhone").value.trim();
  const code  = document.getElementById("vCode").value.trim();

  const res = await fetch(API + "/api/verify", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ phone, code })
  });

  const data = await res.json();

  if(!data.success){
    verifyMsg.innerText = "âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­";
    return;
  }

  verifyMsg.innerHTML = "âœ” ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ â€” Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ø§Ù„Ø¢Ù†...";

  setTimeout(()=>{
    go("login");
  }, 1200);
}
function showLoginRequiredPopup() {
    document.getElementById("loginRequiredPopup").style.display = "flex";
}

function goToLogin() {
    document.getElementById("loginRequiredPopup").style.display = "none";
    go("login");  // ÙŠÙ†Ù‚Ù„Ùƒ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
}

//=================== ØªØ§ÙŠÙ…Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ ======================
let verifyTimer = null;
function startVerifyTimer(){
  let sec = 60;
  document.getElementById("resendBox").style.display = "none";
  document.getElementById("timerBox").style.display = "inline";

  document.getElementById("timer").innerText = sec;

  verifyTimer = setInterval(()=>{
    sec--;
    document.getElementById("timer").innerText = sec;

    if(sec <= 0){
      clearInterval(verifyTimer);
      document.getElementById("timerBox").style.display = "none";
      document.getElementById("resendBox").style.display = "inline";
    }
  },1000);
}
// =================== Ø§Ø¹Ø§Ø¯Ø© Ø§Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ =========================
async function resendVerifyCode(){
  const phone = document.getElementById("vPhone").value;

  const res = await fetch(API + "/api/resend-verify", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ phone })
  });

  const data = await res.json();

  if(data.success){
    verifyMsg.innerHTML = "âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯";
    startVerifyTimer();
  } else {
    verifyMsg.innerHTML = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£";
  }
}



window.onload = async () => {
  await loadProductsCache();   // â† Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹
  renderCart();
  updateCartIcon();
  refreshAllAddToCartButtons();
  go("home");
};

function printInvoice() {
    const invoiceHTML = document.getElementById("invoiceBox").innerHTML;

    const printWin = window.open("", "_blank", "width=900,height=1200");

    printWin.document.open();
    printWin.document.write(`
    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨</title>

      <style>
        @page {
          size: A4;
          margin: 15mm;
        }

        body {
          font-family: 'Cairo', sans-serif;
          background: #fff;
          direction: rtl;
          text-align: right;
          padding: 0 15px;
        }

        .invoice-wrapper {
          width: 100%;
        }

        .header {
          text-align: center;
          margin-bottom: 20px;
        }

        .header h1 {
          color: #8a004a;
          margin-bottom: 5px;
          font-size: 26px;
          font-weight: 900;
        }

        .header .sub {
          font-size: 14px;
          color: #777;
        }

        .section-title {
          font-size: 20px;
          margin: 18px 0 8px;
          color: #8a004a;
          font-weight: 800;
          border-right: 5px solid #8a004a;
          padding-right: 8px;
        }

        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 15px;
        }

        th {
          background: #f9d9e6;
          color: #7a004b;
          padding: 10px;
          border: 1px solid #ccc;
          font-size: 15px;
        }

        td {
          padding: 10px;
          border: 1px solid #ccc;
          font-size: 15px;
        }

        .totals {
          margin-top: 25px;
          font-size: 16px;
          line-height: 1.8;
        }

        .totals div {
          display: flex;
          justify-content: space-between;
          margin: 4px 0;
        }

        .grand-total {
          text-align: center;
          margin-top: 15px;
          font-size: 24px;
          color: #8a004a;
          font-weight: 900;
        }

        .footer {
          text-align: center;
          margin-top: 30px;
          font-size: 14px;
          color: #888;
        }

      </style>
    </head>

    <body>

      <div class="invoice-wrapper">

        <!-- Header -->
        <div class="header">
          <h1>Ù…ØªØ¬Ø± Ø¬Ù…Ø§Ù„Ùƒ</h1>
          <div class="sub">ÙÙˆØ§ØªÙŠØ± â€¢ Ù…Ø´ØªØ±ÙŠØ§Øª â€¢ Ù…Ù†ØªØ¬Ø§Øª Ø£ØµÙ„ÙŠØ©</div>
        </div>

        ${invoiceHTML}

        <div class="footer">
          Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³ÙˆÙ‚ÙƒÙ… â¤ï¸  
          <br>
          www.jamalak-store.com
        </div>

      </div>

    </body>
    </html>
    `);

    printWin.document.close();

    printWin.onload = () => {
        printWin.focus();
        printWin.print();
    };
}


</script>


<!-- ========================= Ø³ÙŠØ¶Ø§Ù Ù‡Ù†Ø§: ÙƒÙˆØ¯ API + ÙƒÙˆØ¯ Ø§Ù„Ø³Ù„Ø© + ÙƒÙˆØ¯ Ø§Ù„ØµÙØ­Ø§Øª ========================= -->

<div id="loginRequiredPopup" 
     style="
        position: fixed; top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.6);
        display:none; justify-content:center; align-items:center;
        z-index:9999;
     ">
  <div style="
      background:white; padding:25px; border-radius:15px;
      width:90%; max-width:350px; text-align:center;
      font-family:'Cairo';">
      
    <h3 style="margin-bottom:10px;color:#8a004a;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨</h3>
    <p style="font-size:17px; color:#444;">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.</p>
    
    <button onclick="goToLogin()" 
        style="
          margin-top:15px; background:#8a004a; color:white;
          padding:10px 20px; border:none; border-radius:10px;
          font-size:17px; font-weight:bold; cursor:pointer;">
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </button>

  </div>
</div>

</body>
</html>


